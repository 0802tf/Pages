<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <title>シェルスクリプト</title>
</head>

<body class="markdown-body">
  <h1>
    <span id="目次" class="fragment"></span><a href="#%E7%9B%AE%E6%AC%A1"><i class="fa fa-link"></i></a>目次
  </h1>
  <p><a
      href="#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%B8%96%E7%95%8C%E3%81%B8%E3%82%88%E3%81%86%E3%81%93%E3%81%9D">シェルスクリプトの世界へようこそ！</a><br>
    <a
      href="#1-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E5%AE%9F%E8%A1%8C%E3%82%92%E4%BD%93%E9%A8%93%E3%81%97%E3%82%88%E3%81%86">1.
      シェルスクリプトの作成と実行を体験しよう</a><br>
    <a
      href="#2-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E5%A4%89%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">2.
      シェルスクリプトで変数を使ってみよう</a><br>
    <a
      href="#3-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E6%89%B1%E3%81%8A%E3%81%86">3.
      シェルスクリプトで文字列を扱おう</a><br>
    <a
      href="#4-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E5%BC%95%E6%95%B0%E3%82%92%E6%89%B1%E3%81%8A%E3%81%86">4.
      シェルスクリプトで引数を扱おう</a><br>
    <a
      href="#5-%E7%89%B9%E6%AE%8A%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8D%E3%81%86">5.
      特殊パラメータについて知ろう</a><br>
    <a
      href="#6-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E9%85%8D%E5%88%97%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">6.
      シェルスクリプトで配列を作ってみよう</a><br>
    <a
      href="#7-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">7.
      シェルスクリプトで条件分岐をしてみよう</a><br>
    <a
      href="#8-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">8.
      シェルスクリプトでループ処理を書いてみよう</a><br>
    <a
      href="#9-%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%87%A6%E7%90%86%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">9.
      関数を使って処理をまとめてみよう</a><br>
    <a
      href="#10-%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E3%83%92%E3%82%A2%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%83%91%E3%82%A4%E3%83%97%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%9D%E3%81%86">10.
      リダイレクト・ヒアドキュメント・パイプを使いこなそう</a><br>
    <a
      href="#11-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%97%E3%82%84%E3%81%99%E3%81%8F%E3%81%97%E3%82%88%E3%81%86">11.
      オプションを使ってデバッグしやすくしよう</a><br>
    <a
      href="#12-%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%B1%95%E9%96%8B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">12.
      便利なパラメータ展開を使ってみよう</a><br>
    <a
      href="#13-%E3%83%96%E3%83%AC%E3%83%BC%E3%82%B9%E5%B1%95%E9%96%8B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">13.
      ブレース展開を使ってみよう</a><br>
    <a
      href="#14-%E3%83%91%E3%82%B9%E5%90%8D%E5%B1%95%E9%96%8B%E3%81%A8%E3%83%81%E3%83%AB%E3%83%80%E5%B1%95%E9%96%8B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">14.
      パス名展開とチルダ展開を使ってみよう</a><br>
    <a
      href="#15-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E7%BD%AE%E6%8F%9B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">15.
      コマンド置換を使ってみよう</a><br>
    <a
      href="#16-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A8%88%E7%AE%97%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">16.
      シェルスクリプトで計算をしてみよう</a><br>
    <a
      href="#17-%E5%8F%AF%E8%AA%AD%E6%80%A7%E3%82%92%E4%B8%8A%E3%81%92%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E8%A6%8F%E7%B4%84%E3%82%92%E5%AE%88%E3%82%8D%E3%81%86">17.
      可読性を上げるためにコーディング規約を守ろう</a><br>
    <a
      href="#18-%E6%9C%80%E5%BE%8C%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E7%B4%B9%E4%BB%8B">18.
      最後に便利なシェルスクリプトで便利なコマンドを紹介！</a>
  </p>
  <div>
  </div>
  <h1>
    <span id="シェルスクリプトの世界へようこそ" class="fragment"></span><a
      href="#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%B8%96%E7%95%8C%E3%81%B8%E3%82%88%E3%81%86%E3%81%93%E3%81%9D"><i
        class="fa fa-link"></i></a>シェルスクリプトの世界へようこそ！
  </h1>
  <h2>
    <span id="シェルスクリプトって何" class="fragment"></span><a
      href="#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A3%E3%81%A6%E4%BD%95"><i
        class="fa fa-link"></i></a>シェルスクリプトって何？
  </h2>
  <p>シェルスクリプトは普段 Bash
    などのシェルで実行しているコマンドを並べて、まとめて実行できるようにしたものです。ファイルのバックアップ、ログファイルの解析、システムのセットアップなど、ターミナルで行っていた一連の作業をまとめてシェルスクリプトに記述することで、シェルスクリプトを実行するだけで自動的に一連の作業を終わらせることができるようになります。また、シェルスクリプトはファイルに保存することになるため、再利用するのも簡単になります。
  </p>
  <p>シェルスクリプトで使うコマンドの多くは UNIX コマンドになると思います。そのため、シェルスクリプトを書く際は UNIX
    コマンドについてある程度の知識があることが前提となってきます。以下の記事などを参考に UNIX コマンドについても学んでおくことをオススメします。</p>
  <h2>
    <span id="シェルスクリプトはいつ使うの" class="fragment"></span><a
      href="#%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AF%E3%81%84%E3%81%A4%E4%BD%BF%E3%81%86%E3%81%AE"><i
        class="fa fa-link"></i></a>シェルスクリプトはいつ使うの？
  </h2>
  <p>
    シェルスクリプトでは変数や条件分岐、ループ処理などの他のプログラミング言語にもあるような機能が使えるので、少し複雑な処理も書くことができます。しかし、言語仕様や実行速度の関係で大規模なシステムの開発には向いていません。シェルスクリプトは以下のような場合に使うのがいいでしょう。
  </p>
  <ul>
    <li>
      <strong>定期的なシステムメンテナンス</strong><br>
      ファイルのバックアップ、ログの分割・圧縮・削除、システムの状態チェックなど、定期的に行う作業の自動化
    </li>
    <li>
      <strong>簡単なデータ処理</strong><br>
      ファイルの検索、テキストの加工、簡単な集計など、UNIXコマンドを組み合わせて行うデータ処理
    </li>
    <li>
      <strong>システムのセットアップやデプロイ</strong><br>
      ソフトウェアのインストール、設定ファイルの編集、サービスの起動・停止など、システムの初期設定やアップデートの自動化
    </li>
    <li>
      <strong>テストスクリプトの作成</strong><br>
      システムやアプリケーションの動作を確認するための簡単なテストスクリプト
    </li>
  </ul>
  <p>他のプログラミング言語と比べたときのメリット、デメリットも紹介します。</p>
  <h3>
    <span id="メリット" class="fragment"></span><a href="#%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><i
        class="fa fa-link"></i></a>メリット
  </h3>
  <ul>
    <li>
      <strong>シェルと同じ言語で書ける</strong><br>
      普段シェル上で作業をしている場合、シェル上での手作業を何度か繰り返して面倒になったら、その流れをシェルスクリプトにそのまま書けばいいだけです。また、シェルスクリプト用にシェルの構文を学ぶことで、普段のシェル上での作業にも活かすことができます。
    </li>
    <li>
      <strong>他のプログラミング言語に比べて短いコードで処理できる</strong><br>
      シェルのコマンドや構文を利用すると他のプログラミング言語に比べて非常に短いコードで目的を達成できることが多いです。ファイルへの出力は <code>&gt;</code>
      (リダイレクト)でできますし、コマンドの実行結果を別のコマンドに渡すのも、変数を介さずに <code>|</code> (パイプ)で繋ぐだけで可能です。
    </li>
  </ul>
  <h3>
    <span id="デメリット" class="fragment"></span><a href="#%E3%83%87%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88"><i
        class="fa fa-link"></i></a>デメリット
  </h3>
  <ul>
    <li>
      <strong>処理速度が遅い</strong><br>
      シェルスクリプトは外部コマンドの起動が遅いので、外部コマンドを頻繁に起動すると、起動のコストが大きくパフォーマンスが低下します。
    </li>
    <li>
      <strong>大規模なアプリケーションの開発には向かない</strong><br>
      シェルスクリプトでは構造体や階層構造を持ったデータ構造を扱えません。また、上記の処理速度の問題もあるため、大規模なアプリケーションの開発には不向きです。シェルスクリプトの規模が大きくなってきたら、他のプログラミング言語への乗り換えを検討すべきです。
    </li>
  </ul>
  <p>シェルスクリプトを使う際は、上記を念頭に入れておきましょう。</p>
  <p>ここまではシェルスクリプトの特徴について解説しました。ここからは実際にシェルスクリプトをどのように書けばいいのかを解説していきます！
  </p>
  <h1>
    <span id="1-シェルスクリプトの作成と実行を体験しよう" class="fragment"></span><a
      href="#1-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AE%E4%BD%9C%E6%88%90%E3%81%A8%E5%AE%9F%E8%A1%8C%E3%82%92%E4%BD%93%E9%A8%93%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>1. シェルスクリプトの作成と実行を体験しよう
  </h1>
  <h2>
    <span id="1-1-シェルスクリプトファイルを作成しよう" class="fragment"></span><a
      href="#1-1-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(1-1) シェルスクリプトファイルを作成しよう
  </h2>
  <p>ターミナルから <code>test.sh</code> という名のシェルスクリプトを作成してみましょう。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>test.sh
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>シェルスクリプトの拡張子について</strong><br>
        基本的に <code>.sh</code> をつけましょう。</p>
      <details>
        <summary>詳細</summary>
        <div>
          <p>シェルスクリプトの拡張子は通常 <code>.sh</code> ですが、必須ではありません。
            <code>test</code> というファイル名でもシェルスクリプトとして実行可能です。ただし、<code>.sh</code>
            拡張子をつけることでシェルスクリプトだと理解しやすくなるため、基本的には拡張子をつけることをオススメします。
          </p>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="1-2-シェルスクリプトファイルを編集しよう" class="fragment"></span><a
      href="#1-2-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(1-2) シェルスクリプトファイルを編集しよう
  </h2>
  <p>作成した <code>test.sh</code> をお好みのエディタで下記のように編集してみましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'Hello world!'</span>
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>shebang</strong><br>
        スクリプト行頭の <code>#!</code> で始まる行を <code>shebang</code> (シェバン/シェバング/シバン)と言います。</p>
      <details>
        <summary>詳細</summary>
        <div>
          <p>どのプログラムでスクリプトを実行すべきかを指定するためのものです。 <code>shebang</code>
            はシェルスクリプト限定のものではなく、スクリプト言語すべてに対して使えます(ex.
            <code>#!/usr/bin/env python3</code>)。スクリプトファイルに後述の実行権限をつけて直接実行すると、シェルがこの
            <code>shebang</code> を見て、該当するプログラムでスクリプトファイルを実行します。これにより、シェルスクリプトのファイル名に <code>.sh</code>
            拡張子がついていなくても、実行時にシェルスクリプトとして実行されます。
          </p>
        </div>
      </details>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong><code>#!/bin/bash</code> と <code>#!/bin/sh</code>
          の使い分け</strong><br>
        基本的に　<code>#!/bin/bash</code>　を使うのが良さそうです。</p>
      <details>
        <summary>詳細</summary>
        <div>
          <ul>
            <li>シェルスクリプトのサンプルでは <code>#!/bin/bash</code> と
              <code>#!/bin/sh</code> の2つがよく現れますが、結論、基本的に <code>#!/bin/bash</code> を使うのが良さそうです。bash の方が
              sh より機能が多く便利なためです。bash では使えるコマンドや記法が sh では使えないこともあります。
            </li>
            <li>移植性を気にする場合は <code>#!/bin/sh</code>
              を使いましょう。<code>#!/bin/sh</code>ではPOSIX(UNIX 系 OS
              間でアプリケーションの移植性を高めるために定義された標準規格)準拠の動きをするプログラムでシェルスクリプトを実行します。(Red Hat 系の Linux では bash
              のPOSIXモードが実行され、Ubuntu 系の Linux では dash というプログラムが実行されます。)</li>
          </ul>
        </div>
      </details>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p>以下では <code>#!/bin/bash</code> の場合のシェルスクリプトについて説明していきます。</p>
    </div>
  </div>
  <h2>
    <span id="1-3-シェルスクリプトに実行権限をつけよう" class="fragment"></span><a
      href="#1-3-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AB%E5%AE%9F%E8%A1%8C%E6%A8%A9%E9%99%90%E3%82%92%E3%81%A4%E3%81%91%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(1-3) シェルスクリプトに実行権限をつけよう
  </h2>
  <p>ターミナルで <code>test.sh</code> に実行権限をつけてみましょう。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">chmod</span> +x test.sh
</code></pre>
    </div>
  </div>
  <h2>
    <span id="1-4-シェルスクリプトを実行してみよう" class="fragment"></span><a
      href="#1-4-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(1-4) シェルスクリプトを実行してみよう
  </h2>
  <p>ターミナルから <code>test.sh</code> を実行してみましょう。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">Hello world!
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>シェルスクリプトの実行方法について</strong><br>
        実行権限をつけたファイル名を直接指定して実行しましょう。</p>
      <details>
        <summary>詳細</summary>
        <div>
          <p>
            上で説明した「実行権限をつけたファイル名を指定して実行する」方法(<code>./test.sh</code>)の他に、 <code>sh test.sh</code>,
            <code>bash test.sh</code>, <code>source test.sh</code>, <code>. ./test.sh</code>
            といった実行方法もあります。しかし、ターミナルからシェルスクリプトを実行する際は、「実行権限をつけたファイル名を指定して実行する」方法を推奨します。例えば、 shebang に
            <code>#!/bin/bash</code> と書かれたシェルスクリプトファイルを <code>sh test.sh</code> として実行した場合、 shebang
            が無視されて sh で実行されることになり、bash 用に書いていたスクリプトが動かないといったことが起こり得ます。
          </p>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="1-5-シェルスクリプトにコメントをつけてみよう" class="fragment"></span><a
      href="#1-5-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AB%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E3%81%A4%E3%81%91%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(1-5) シェルスクリプトにコメントをつけてみよう
  </h2>
  <p><code>test.sh</code> を編集してコメントをつけてみましょう。シェルスクリプトのコメントは
    <code>#</code> でつけることができます。コメントアウトされたコマンドは実行されません。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="c"># ここはコメントです。</span>
<span class="c"># echo 'この行は実行されません。'</span>

<span class="nb">echo</span> <span class="s1">'Hello world!'</span> <span class="c"># 行の途中からでもコメントをつけることができます。</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">Hello world!
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="1-6-シェルスクリプトで複数のコマンドを実行してみよう" class="fragment"></span><a
      href="#1-6-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(1-6) シェルスクリプトで複数のコマンドを実行してみよう
  </h2>
  <ul>
    <li>
      <strong>改行で区切る場合</strong><br>
      シェルスクリプトでは基本的に1つの行に1つのコマンドを書いていきますが、この時改行が1つのコマンドを区切る役割を果たしています。そのため、コマンドの途中で改行を入れることはできません。ただし、行末に
      <code>\</code> を書くことで、改行をまたいで1つのコマンドとして実行することも可能です。
    </li>
  </ul>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'Hello world!'</span> 
<span class="nb">pwd</span>                 <span class="c"># 改行で区切られているので上のechoとは別のコマンドとして実行される</span>
<span class="nb">echo</span> <span class="se">\ </span>             <span class="c"># 改行をまたいで1つのコマンドとして実行可能</span>
        <span class="s1">'I'</span> <span class="se">\ </span>      <span class="c"># 複数行にわたって繋げることができる</span>
        <span class="s1">'like'</span> <span class="se">\ </span>   <span class="c"># コマンド名やオプションが長くなって来た時に使おう</span>
        <span class="s1">'shell'</span> <span class="se">\</span>
        <span class="s1">'script'</span>
<span class="nb">echo</span>                <span class="c"># 引数なしの echo コマンドとして実行される</span>
<span class="s1">'End world!'</span>        <span class="c"># 'End world!' というコマンドを実行しようとするが存在しないのでエラーになる</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">Hello world!                                                  
/Users/user1/work/shellscript
I like shell script

./test.sh: line 11: End world!: command not found        
</span></code></pre>
    </div>
  </div>
  <ul>
    <li>
      <strong><code>;</code> で区切る場合</strong><br>
      1つの行に複数のコマンドを書くことも可能です。コマンド同士を <code>;</code> で区切ると別々のコマンドとして逐次実行してくれます。
    </li>
  </ul>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'Hello world!'</span><span class="p">;</span> <span class="nb">pwd</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">'End world!'</span><span class="p">;</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">
Hello world!                                                  
/Users/user1/work/shellscript
End world!
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="2-シェルスクリプトで変数を使ってみよう" class="fragment"></span><a
      href="#2-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E5%A4%89%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>2. シェルスクリプトで変数を使ってみよう
  </h1>
  <h2>
    <span id="2-1-変数への代入" class="fragment"></span><a
      href="#2-1-%E5%A4%89%E6%95%B0%E3%81%B8%E3%81%AE%E4%BB%A3%E5%85%A5"><i class="fa fa-link"></i></a>(2-1) 変数への代入
  </h2>
  <p>変数へ値を代入するときは <code>変数名=値</code> の形式で書きます。可読性目的で
    <strong><code>=</code> の前後にスペースを入れてはいけません</strong>。言語的にエラーになってしまいます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s1">'value'</span>   <span class="c"># = の周りにスペースを入れてはいけません</span>
<span class="nb">echo</span> <span class="nv">$var</span>     <span class="c"># 後述しますが $ は変数を参照する時につける記号です</span>

<span class="nv">var</span><span class="o">=</span><span class="s1">'change'</span>  <span class="c"># 定義済みの変数の値を変更することも可能です</span>
<span class="nb">echo</span> <span class="nv">$var</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value
change
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>変数への代入時に <code>=</code>
          の前後にスペースを入れてはいけない理由</strong><br>
        <code>=</code> の前の文字列が変数ではなくコマンドとして扱われてしまうためです。
      </p>
      <details>
        <summary>詳細</summary>
        <div>
          <p>実際に <code>=</code> の前後にスペースを入れて実行してみるとどうなるでしょうか？　</p>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

var <span class="o">=</span> <span class="s1">'value'</span>
<span class="nb">echo</span> <span class="nv">$var</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">./test.sh: line 3: var: command not found
</span></code></pre>
            </div>
          </div>
          <p>このエラーは「var というコマンドに = と 'value'
            という引数を与えた」と解釈されるために起こります。<br>
            コマンドとして解釈されないために、 <code>=</code> の前後にスペースを入れてはいけないのです。</p>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="2-2-変数の参照" class="fragment"></span><a href="#2-2-%E5%A4%89%E6%95%B0%E3%81%AE%E5%8F%82%E7%85%A7"><i
        class="fa fa-link"></i></a>(2-2)
    変数の参照
  </h2>
  <p>変数を参照するときは <code>$変数名</code> のように変数名の前に <code>$</code> をつけます。また、
    <code>${変数名}</code> のように <code>{}</code> で囲んでも参照できます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var1</span><span class="o">=</span><span class="s1">'value'</span> 
<span class="nb">echo</span> <span class="nv">$var1</span>   <span class="c"># $ で変数を参照</span>

<span class="nv">var2</span><span class="o">=</span><span class="nv">$var1</span>   <span class="c"># 代入先の変数には $ をつけません</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var2</span><span class="k">}</span> <span class="c"># {} をつけても参照できます</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value
value
change
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>変数名に使える文字</strong><br>
        半角英数字とアンダーバー(<code>_</code>)が使えます。ただし、数字で始まる変数名は使えません。また、英語の大文字と小文字は区別されます。</p>
      <details>
        <summary>例</summary>
        <div>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="c"># 1var='error' (数字で始まる変数名は使用不可です)</span>

<span class="nv">_var1</span><span class="o">=</span><span class="s1">'_var1'</span>
<span class="nb">echo</span> <span class="nv">$_var1</span>

<span class="nv">Var_1</span><span class="o">=</span><span class="s1">'Var_1'</span> <span class="c"># OK</span>
<span class="nb">echo</span> <span class="nv">$Var_1</span>


<span class="c"># 大文字小文字は区別されます</span>
<span class="nv">var</span><span class="o">=</span><span class="s1">'lower'</span>
<span class="nb">echo</span> <span class="nv">$var</span>
<span class="nv">VAR</span><span class="o">=</span><span class="s1">'UPPER'</span>
<span class="nb">echo</span> <span class="nv">$VAR</span>
<span class="nv">Capital</span><span class="o">=</span><span class="s1">'Capital'</span>
<span class="nb">echo</span> <span class="nv">$Capital</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">_var1
Var_1
lower
UPPER
Capital
</span></code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="2-3-readonly-による変数の上書き防止" class="fragment"></span><a
      href="#2-3-readonly-%E3%81%AB%E3%82%88%E3%82%8B%E5%A4%89%E6%95%B0%E3%81%AE%E4%B8%8A%E6%9B%B8%E3%81%8D%E9%98%B2%E6%AD%A2"><i
        class="fa fa-link"></i></a>(2-3) <code>readonly</code> による変数の上書き防止
  </h2>
  <p><code>readonly</code>
    をつけて変数を定義することで上書きができなくなります。<strong>定数</strong>の定義に使うといいでしょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">readonly </span><span class="nv">VAR</span><span class="o">=</span><span class="s1">'hoge'</span>
<span class="nv">VAR</span><span class="o">=</span><span class="s1">'fuga'</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">./test.sh: line 4: VAR: readonly variable
</span></code></pre>
    </div>
  </div>

  <h2>
    <span id="2-4-unset-による変数の削除" class="fragment"></span><a
      href="#2-4-unset-%E3%81%AB%E3%82%88%E3%82%8B%E5%A4%89%E6%95%B0%E3%81%AE%E5%89%8A%E9%99%A4"><i
        class="fa fa-link"></i></a>(2-4) <code>unset</code> による変数の削除
  </h2>
  <p><code>unset</code> コマンドを使うことで変数を未定義の状態に戻すことができます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s1">'set'</span>
<span class="nb">echo</span> <span class="nv">$var</span>
<span class="nb">unset </span>var <span class="c"># unset するときは $ をつけない</span>
<span class="nb">echo</span> <span class="nv">$var</span> <span class="c"># 未定義なので何も表示されない</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">set

</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="3-シェルスクリプトで文字列を扱おう" class="fragment"></span><a
      href="#3-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E6%89%B1%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>3. シェルスクリプトで文字列を扱おう
  </h1>
  <h2>
    <span id="3-1-シェルスクリプトにおける文字列の扱い" class="fragment"></span><a
      href="#3-1-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E6%89%B1%E3%81%84"><i
        class="fa fa-link"></i></a>(3-1) シェルスクリプトにおける文字列の扱い
  </h2>
  <p>シェルスクリプトでは文字列の前後をクォーテーション(<code>''</code> や
    <code>""</code>)で囲まなくても文字列として扱われます。ただし、スペースやタブを含む文字列を1つの文字列として扱いたい場合はクォーテーションで囲む必要があります。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span>value       <span class="c"># クォーテーションをつけなくても文字列の扱いになる</span>
<span class="nb">echo</span> <span class="nv">$var</span>
<span class="nv">var</span><span class="o">=</span><span class="s1">'hoge fuga'</span> <span class="c"># スペースを含む場合はクォーテーションをつける必要がある</span>
<span class="nb">echo</span> <span class="nv">$var</span>
<span class="nv">var</span><span class="o">=</span>hoge fuga   <span class="c"># クォーテーションをつけないと予期せぬエラーに</span>
<span class="nb">echo</span> <span class="nv">$var</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value
hoge fuga
./test.sh: line 7: fuga: command not found
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="3-2-空文字と未定義" class="fragment"></span><a
      href="#3-2-%E7%A9%BA%E6%96%87%E5%AD%97%E3%81%A8%E6%9C%AA%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>(3-2)
    空文字と未定義
  </h2>
  <p>
    変数には空文字を代入することもできます。空文字が代入された変数を参照した時と、未定義の変数を参照した時は同じ結果に見えますが、状態としては全く別の扱いになります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">empty</span><span class="o">=</span><span class="s1">''</span>
<span class="nb">echo</span> <span class="se">\$</span>empty: <span class="nv">$empty</span> <span class="c"># 後述のエスケープを使用</span>
<span class="nv">empty</span><span class="o">=</span> <span class="c"># これも空文字を意味する</span>
<span class="nb">echo</span> <span class="se">\$</span>empty: <span class="nv">$empty</span>
<span class="nb">echo</span> <span class="se">\$</span>undefined: <span class="nv">$undefined</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">$</span>empty:
<span class="gp">$</span>empty:
<span class="gp">$</span>undefined:
</code></pre>
    </div>
  </div>
  <h2>
    <span id="3-3-特殊文字とエスケープ" class="fragment"></span><a
      href="#3-3-%E7%89%B9%E6%AE%8A%E6%96%87%E5%AD%97%E3%81%A8%E3%82%A8%E3%82%B9%E3%82%B1%E3%83%BC%E3%83%97"><i
        class="fa fa-link"></i></a>(3-3) 特殊文字とエスケープ
  </h2>
  <p>シェルスクリプトでは以下の文字は特殊文字として扱われます。</p>
  <div class="code-frame" data-lang="text">
    <div class="highlight">
      <pre><code>* ? [ ' " ` \ $ ; &amp; ( ) | ~ &lt; &gt; # % = スペース タブ 改行
</code></pre>
    </div>
  </div>
  <p>これらの文字を単に文字列として使用したいときは <code>\</code> を前に置いてエスケープして使いましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span>value
<span class="nb">echo</span> <span class="nv">$var</span>
<span class="nb">echo</span> <span class="se">\$</span>var      <span class="c"># $ をエスケープすることでパラメータ展開させない</span>
<span class="nb">echo</span> <span class="se">\$</span>var <span class="nv">$var</span> <span class="c"># 並べて出力</span>
<span class="nb">echo</span> <span class="se">\\</span>         <span class="c"># \ 自身も \ でエスケープできる</span>

<span class="nv">var</span><span class="o">=</span>hoge<span class="se">\ </span>fuga  <span class="c"># スペースをエスケープすることで連続した文字列として処理できる(見づらいので非推奨)</span>
<span class="nb">echo</span> <span class="nv">$var</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value
</span><span class="gp">$</span>var
<span class="gp">$</span>var value
<span class="go">\
hoge fuga
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="3-4-文字列をシングルクォーテーションで囲む" class="fragment"></span><a
      href="#3-4-%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%82%AF%E3%82%A9%E3%83%BC%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E5%9B%B2%E3%82%80"><i
        class="fa fa-link"></i></a>(3-4) 文字列をシングルクォーテーションで囲む
  </h2>
  <p>
    シェルスクリプトでは文字列をダブルクォーテーションで囲んだ時と、シングルクォーテーションで囲んだ時とで、内部の文字列の扱いに明確な差があります。シングルクォーテーションで囲んだ文字列では、シングルクォーテーション以外の特殊文字がエスケープされます。結果として、シングルクォーテーション内では式が展開されません。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var1</span><span class="o">=</span>value
<span class="nv">var2</span><span class="o">=</span><span class="s1">'${var1}'</span>
<span class="nb">echo</span> <span class="nv">$var2</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">$</span><span class="o">{</span>var1<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <h2>
    <span id="3-5-文字列をダブルクォーテーションで囲む" class="fragment"></span><a
      href="#3-5-%E6%96%87%E5%AD%97%E5%88%97%E3%82%92%E3%83%80%E3%83%96%E3%83%AB%E3%82%AF%E3%82%A9%E3%83%BC%E3%83%86%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E5%9B%B2%E3%82%80"><i
        class="fa fa-link"></i></a>(3-5) 文字列をダブルクォーテーションで囲む
  </h2>
  <p>一方、ダブルクォーテーションで囲んだ文字列では <code>$</code>, <code>`</code>,
    <code>/</code> 以外の特殊文字がエスケープされます。このため、ダブルクォーテーションの中では以下が機能します。
  </p>
  <ul>
    <li>
      <code>$</code> による式展開
    </li>
    <li>
      <code>`</code> によるコマンド置換(後述)
    </li>
    <li>
      <code>/</code> によるエスケープ
    </li>
  </ul>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var1</span><span class="o">=</span>value
<span class="nv">var2</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">var1</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nv">$var2</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="3-6-文字列の連結" class="fragment"></span><a
      href="#3-6-%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E9%80%A3%E7%B5%90"><i class="fa fa-link"></i></a>(3-6) 文字列の連結
  </h2>
  <p>文字列を連結するには演算子は必要なく、繋げて記述すれば連結できます。文字列の間にスペースは不要です。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var1</span><span class="o">=</span><span class="s1">'hoge''fuga'</span>
<span class="nb">echo</span> <span class="s1">'$var1'</span>: <span class="nv">$var1</span>

<span class="nv">var2</span><span class="o">=</span>hoge
<span class="nv">var3</span><span class="o">=</span><span class="nv">$var1$var2</span>
<span class="nb">echo</span> <span class="s1">'$var3'</span>: <span class="nv">$var3</span>

<span class="c"># 以下は $var3 と同じ結果になるでしょうか?</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="se">\$</span><span class="s2">var1hoge"</span>: <span class="nv">$var1hoge</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="se">\$</span><span class="s2">var1'hoge'"</span>: <span class="nv">$var1</span><span class="s1">'hoge'</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="se">\$</span><span class="s2">{var1}hoge"</span>: <span class="k">${</span><span class="nv">var1</span><span class="k">}</span>hoge
<span class="nb">echo</span> <span class="s2">"</span><span class="se">\$</span><span class="s2">{var1}'hoge'"</span>: <span class="k">${</span><span class="nv">var1</span><span class="k">}</span><span class="s1">'hoge'</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="nv">$ </span>./test.sh
<span class="o">(</span>見やすいように整形しています<span class="o">)</span>
<span class="nv">$var1</span>:         hogefuga
<span class="nv">$var3</span>:         hogefugahoge
<span class="nv">$var1hoge</span>:                  <span class="c"># var1hoge という変数として扱われ、未定義なので何も表示されません</span>
<span class="nv">$var1</span><span class="s1">'hoge'</span>:   hogefugahoge
<span class="k">${</span><span class="nv">var1</span><span class="k">}</span>hoge:   hogefugahoge 
<span class="k">${</span><span class="nv">var1</span><span class="k">}</span><span class="s1">'hoge'</span>: hogefugahoge
</code></pre>
    </div>
  </div>
  <h1>
    <span id="4-シェルスクリプトで引数を扱おう" class="fragment"></span><a
      href="#4-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E5%BC%95%E6%95%B0%E3%82%92%E6%89%B1%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>4. シェルスクリプトで引数を扱おう
  </h1>
  <h2>
    <span id="4-1-シェルスクリプトへの引数の渡し方" class="fragment"></span><a
      href="#4-1-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%B8%E3%81%AE%E5%BC%95%E6%95%B0%E3%81%AE%E6%B8%A1%E3%81%97%E6%96%B9"><i
        class="fa fa-link"></i></a>(4-1) シェルスクリプトへの引数の渡し方
  </h2>
  <p>シェルスクリプト実行時に引数を渡すには、以下のように、スクリプトファイル名の後ろに複数の文字列をスペース区切りで列挙します。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh arg1 arg2 arg3
</code></pre>
    </div>
  </div>
  <h2>
    <span id="4-2-位置パラメータ" class="fragment"></span><a
      href="#4-2-%E4%BD%8D%E7%BD%AE%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF"><i class="fa fa-link"></i></a>(4-2)
    位置パラメータ
  </h2>
  <ul>
    <li>実行時に渡された引数は、位置パラメータという特殊パラメータで保持されます。位置パラメータは <code>$1</code> ~
      <code>$9</code> で参照することができます(<code>${1}</code> ~ <code>${9}</code> でも可能)。
    </li>
    <li>10番目以降の位置パラメータは <code>${10}</code> のように <code>{}</code>
      をつける必要があります。</li>
  </ul>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'$1'</span>: <span class="nv">$1</span>       <span class="c"># {} なくても OK</span>
<span class="nb">echo</span> <span class="s1">'${2}'</span>: <span class="k">${</span><span class="nv">2</span><span class="k">}</span>   <span class="c"># {} があっても OK</span>
<span class="nb">echo</span> <span class="s1">'"$3"'</span>: <span class="s2">"</span><span class="nv">$3</span><span class="s2">"</span>   <span class="c"># もちろんダブルクォーテーションの中でも展開される</span>
<span class="nb">echo</span> <span class="s1">'${10}'</span>: <span class="k">${</span><span class="nv">10</span><span class="k">}</span> <span class="c"># 10番目以降は {} が必要</span>
<span class="nb">echo</span> <span class="s1">'${11}'</span>: <span class="k">${</span><span class="nv">11</span><span class="k">}</span> <span class="c"># 引数として指定されていない番号の位置パラメータには値が設定されない</span>
<span class="nb">echo</span> <span class="s1">'$10'</span>:<span class="nv">$10</span>      <span class="c"># $1 の部分が先に展開され、文字列の連結として処理される</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="nv">$ </span>./test.sh arg1 2 3 4 5 6 7 8 9 10
<span class="o">(</span>見やすいように整形しています<span class="o">)</span>
<span class="nv">$1</span>:    arg1
<span class="k">${</span><span class="nv">2</span><span class="k">}</span>:  2
<span class="s2">"</span><span class="nv">$3</span><span class="s2">"</span>:  3
<span class="k">${</span><span class="nv">10</span><span class="k">}</span>: 10
<span class="k">${</span><span class="nv">11</span><span class="k">}</span>: 
<span class="nv">$10</span>:   arg10
</code></pre>
    </div>
  </div>
  <h1>
    <span id="5-特殊パラメータについて知ろう" class="fragment"></span><a
      href="#5-%E7%89%B9%E6%AE%8A%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E7%9F%A5%E3%82%8D%E3%81%86"><i
        class="fa fa-link"></i></a>5. 特殊パラメータについて知ろう
  </h1>
  <p>位置パラメータも特殊パラメータの一種ですが、他にも様々な意味の特殊パラメータが存在します。</p>
  <h2>
    <span id="5-1-0" class="fragment"></span><a href="#5-1-0"><i class="fa fa-link"></i></a>(5-1)
    <code>$0</code>
  </h2>
  <p>位置パラメータは <code>$1</code> から始まっていましたが、では <code>$0</code>
    は何を表すでしょうか？<br>
    確認してみましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="nv">$0</span>
<span class="nb">echo</span> <span class="nv">$1</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh arg1
<span class="go">./test.sh
arg1
</span></code></pre>
    </div>
  </div>
  <p><code>$0</code> は実行されたシェルスクリプトの名前を保持する特殊パラメータになります。</p>
  <h2>
    <span id="5-2-" class="fragment"></span><a href="#5-2-"><i class="fa fa-link"></i></a>(5-2)
    <code>$?</code>
  </h2>
  <p><code>$?</code> は直前に実行したコマンドの終了ステータスを保持します。</p>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>Linux におけるコマンドの終了ステータスについて</strong></p>
      <ul>
        <li>Linux におけるコマンドの終了ステータスの範囲は符号なしの8ビットの範囲である
          <code>0 ~ 255</code> に限られます。
        </li>
        <li>終了ステータス <code>0</code> のみが正常終了を表し、他の値は異常終了を表します。</li>
      </ul>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>シェルスクリプトの終了ステータスについて</strong></p>
      <ul>
        <li>シェルスクリプトでは <code>exit 0</code> や <code>exit 1</code> のように
          <code>exit</code> コマンドで終了ステータスを指定することができます。
        </li>
        <li>シェルスクリプト内で <code>exit</code>
          コマンドの省略は可能ですが、その場合、シェルスクリプト内で最後に実行されたコマンドの終了ステータスがそのシェルスクリプトの終了ステータスとなります。</li>
      </ul>
    </div>
  </div>
  <p>以下の入力された引数に応じて終了ステータスを返すシェルスクリプトで、 <code>$?</code>
    の値がどうなるか確認してみましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'入力値'</span> <span class="nv">$1</span> <span class="c"># 第１引数を出力</span>
<span class="nb">exit</span> <span class="nv">$1</span> <span class="c"># exit コマンドで終了ステータスを指定</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh 0<span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' 0
'終了ステータス' 0

</span><span class="gp">$</span><span class="w"> </span>./test.sh 1<span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' 1
'終了ステータス' 1

</span><span class="gp">$</span><span class="w"> </span>./test.sh 255<span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' 255
'終了ステータス' 255

</span><span class="gp">$</span><span class="w"> </span>./test.sh 256<span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' 256
'終了ステータス' 0

</span><span class="gp">$</span><span class="w"> </span>./test.sh 257<span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' 257
'終了ステータス' 1

</span><span class="gp">$</span><span class="w"> </span>./test.sh <span class="nt">-1</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' -1
'終了ステータス' 255

</span><span class="gp">$</span><span class="w"> </span>./test.sh <span class="nt">-2</span><span class="p">;</span> <span class="nb">echo</span> <span class="s1">'終了ステータス'</span> <span class="nv">$?</span>
<span class="go">'入力値' -2
'終了ステータス' 254
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="5-3-" class="fragment"></span><a href="#5-3-"><i class="fa fa-link"></i></a>(5-3)
    <code>$#</code>
  </h2>
  <p><code>$#</code> はスクリプトに与えられた引数の数を保持します。</p>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>位置パラメータと <code>$#</code> と <code>shift</code>
          コマンド</strong><br>
        <code>shift</code> コマンドを実行すると、位置パラメータの内容が左に1つ移動します(<code>$2</code> の値が <code>$1</code> に、
        <code>$3</code> の値が <code>$2</code> に、 ... といった具合です）。また、同時に <code>$#</code> の値も 1
        減少します。<code>shift</code> を繰り返し、 <code>$#</code> の値が 0 になった後にさらに <code>shift</code>
        を実行するとエラーになります。
      </p>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="nt">-----------</span>
<span class="nb">echo </span>引数の数 <span class="nv">$#</span>
<span class="nb">echo</span> <span class="s1">'$1'</span>の値 <span class="nv">$1</span>
<span class="nb">echo</span> <span class="s1">'$2'</span>の値 <span class="nv">$2</span>
<span class="nb">shift
echo</span> <span class="nv">$?</span>
<span class="nb">echo</span> <span class="nt">-----------</span>
<span class="nb">echo </span>引数の数 <span class="nv">$#</span>
<span class="nb">echo</span> <span class="s1">'$1'</span>の値 <span class="nv">$1</span>
<span class="nb">echo</span> <span class="s1">'$2'</span>の値 <span class="nv">$2</span>
<span class="nb">shift
echo</span> <span class="nv">$?</span>
<span class="nb">echo</span> <span class="nt">-----------</span>
<span class="nb">echo </span>引数の数 <span class="nv">$#</span>
<span class="nb">echo</span> <span class="s1">'$1'</span>の値 <span class="nv">$1</span>
<span class="nb">echo</span> <span class="s1">'$2'</span>の値 <span class="nv">$2</span>
<span class="nb">shift
echo</span> <span class="nv">$?</span>
<span class="nb">echo</span> <span class="nt">-----------</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="nv">$ </span>./test.sh arg1 arg2
<span class="nt">-----------</span>
引数の数 2
<span class="nv">$1</span>の値 arg1
<span class="nv">$2</span>の値 arg2
0
<span class="nt">-----------</span>
引数の数 1
<span class="nv">$1</span>の値 arg2  <span class="c"># 元々 $1 に入っていた値は消えてしまうので注意</span>
<span class="nv">$2</span>の値       <span class="c"># $2 の値が $1 に移動して、$2 は未定義の状態になる</span>
0
<span class="nt">-----------</span>
引数の数 0
<span class="nv">$1</span>の値
<span class="nv">$2</span>の値
1           <span class="c"># $# の値が 0 になった後に shift したので失敗</span>
<span class="nt">-----------</span>
</code></pre>
    </div>
  </div>
  <h2>
    <span id="5-4--" class="fragment"></span><a href="#5-4--"><i class="fa fa-link"></i></a>(5-4)
    <code>"$*"</code>, <code>"$@"</code>
  </h2>
  <p</code>
    は位置パラメータを集合的に扱うための特殊パラメータです。<code>"$*"</code>
    は全ての位置パラメータを結合して、1つの引数として処理するときに使用します。<code>"$@"</code> は全ての位置パラメータを個別のまま処理するときに使用します。<br>
    まだ紹介していない関数を使った例になりますが、<code>"$*"</code>, <code>"$@"</code> の挙動を確認してみましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>echo_args<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'引数の数'</span> <span class="nv">$#</span>
  <span class="nb">echo</span> <span class="s1">'第1引数'</span> <span class="nv">$1</span>
  <span class="nb">echo</span> <span class="s1">'第2引数'</span> <span class="nv">$2</span>
  <span class="nb">echo</span> <span class="s1">'第3引数'</span> <span class="nv">$3</span>
  <span class="nb">echo</span> <span class="nt">--------------------</span>
<span class="o">}</span>

<span class="nb">echo</span> <span class="s1">'"$@"'</span>の場合
echo_args <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="c"># echo_args "$1" "$2" "$3" ... と同じ</span>
<span class="nb">echo</span> <span class="s1">'"$*"'</span>の場合
echo_args <span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span> <span class="c"># echo_args "$1 $2 $3 ..." と同じ</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh arg1 arg2 arg3
<span class="gp">"$</span>@<span class="s2">"の場合
</span><span class="go">引数の数 3
第1引数 arg1
第2引数 arg2
第3引数 arg3
--------------------
</span><span class="gp">"$</span><span class="k">*</span><span class="s2">"の場合
</span><span class="go">引数の数 1
第1引数 arg1 arg2 arg3
第2引数
第3引数

</span><span class="gp">$</span><span class="w"> </span>./test.sh <span class="s2">"arg1 arg2"</span> <span class="s2">"arg3"</span>
<span class="gp">"$</span>@<span class="s2">"の場合
</span><span class="go">引数の数 2
第1引数 arg1 arg2
第2引数 arg3
第3引数
--------------------
</span><span class="gp">"$</span><span class="k">*</span><span class="s2">"の場合
</span><span class="go">引数の数 1
第1引数 arg1 arg2 arg3
第2引数
第3引数
--------------------
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p>ダブルクォーテーションをつけていない <code>$*</code> と <code>$@</code>
        は想定と異なる動きをする危険があるので、詳しい挙動を知らない場合は使わない方が無難です。使用する際は <code>"$*"</code>, <code>"$@"</code>
        を使いましょう。</p>
      <details>
        <summary><code>$*</code> と <code>$@</code> の場合の結果</summary>
        <div>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>echo_args<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s1">'引数の数'</span> <span class="nv">$#</span>
  <span class="nb">echo</span> <span class="s1">'第1引数'</span> <span class="nv">$1</span>
  <span class="nb">echo</span> <span class="s1">'第2引数'</span> <span class="nv">$2</span>
  <span class="nb">echo</span> <span class="s1">'第3引数'</span> <span class="nv">$3</span>
  <span class="nb">echo</span> <span class="nt">--------------------</span>
<span class="o">}</span>

<span class="nb">echo</span> <span class="s1">'$@'</span>の場合
echo_args <span class="nv">$@</span> <span class="c"># 非推奨</span>
<span class="nb">echo</span> <span class="s1">'$*'</span>の場合
echo_args <span class="nv">$*</span> <span class="c"># 非推奨</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh arg1 arg2 arg3
<span class="gp">$</span>@の場合
<span class="go">引数の数 3
第1引数 arg1
第2引数 arg2
第3引数 arg3
--------------------
</span><span class="gp">$</span><span class="k">*</span>の場合
<span class="go">引数の数 3
第1引数 arg1
第2引数 arg2
第3引数 arg3
--------------------

</span><span class="gp">$</span><span class="w"> </span>./test.sh <span class="s2">"arg1 arg2"</span> <span class="s2">"arg3"</span>
<span class="gp">$</span>@の場合
<span class="go">引数の数 3
第1引数 arg1
第2引数 arg2
第3引数 arg3
--------------------
</span><span class="gp">$</span><span class="k">*</span>の場合
<span class="go">引数の数 3
第1引数 arg1
第2引数 arg2
第3引数 arg3
--------------------
</span></code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="5-5--" class="fragment"></span><a href="#5-5--"><i class="fa fa-link"></i></a>(5-5)
    <code>$$</code>, <code>$!</code>
  </h2>
  <p><code>$$</code> は実行されたシェルスクリプトのプロセスIDを保持します。<br>
    <code>$!</code> は最後に実行したバックグラウンドプロセスのプロセスIDを保持します。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="nv">$$</span> <span class="c"># このスクリプトが実行されているプロセスIDを返す</span>

<span class="o">(</span><span class="nb">sleep </span>10<span class="p">;</span> <span class="nb">echo</span> <span class="s1">'end'</span><span class="o">)</span> &amp; <span class="c"># &amp;(アンパサンド)によりバックグランドで実行され、10秒経つ前に次の行に進む</span>
<span class="nb">echo</span> <span class="nv">$!</span> <span class="c"># 上のコマンドが実行されているバックグランドプロセスのプロセスIDを返す</span>
<span class="nb">wait</span> <span class="nv">$!</span> <span class="c"># プロセスの終了を待つ。$! は最後に実行されたバックグランドプロセスのプロセスIDなので値は変わっていない。</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">19664
19665
end
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="6-シェルスクリプトで配列を作ってみよう" class="fragment"></span><a
      href="#6-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E9%85%8D%E5%88%97%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>6. シェルスクリプトで配列を作ってみよう
  </h1>
  <p>シェルスクリプトでも他の言語同様に配列が使えます。</p>
  <h2>
    <span id="6-1-配列の複合代入" class="fragment"></span><a
      href="#6-1-%E9%85%8D%E5%88%97%E3%81%AE%E8%A4%87%E5%90%88%E4%BB%A3%E5%85%A5"><i class="fa fa-link"></i></a>(6-1)
    配列の複合代入
  </h2>
  <p>配列へ値を代入するときは、変数への代入文の右辺で <code>()</code> の中に要素を並べ、
    <code>変数名=(要素1 要素2 要素3 ...)</code> のように書きます。普通の変数への代入と同じく、 <code>=</code>
    の前後にスペースを書いてはいけません。逆に、配列の要素間にはスペースが必要です。
  </p>
  <h2>
    <span id="6-2-配列の要素の参照" class="fragment"></span><a
      href="#6-2-%E9%85%8D%E5%88%97%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E5%8F%82%E7%85%A7"><i
        class="fa fa-link"></i></a>(6-2) 配列の要素の参照
  </h2>
  <p>配列の要素を参照するときは <code>${変数名[インデックス]}</code> のように書きます。例えば
    <code>${array[1]}</code> のようになります。変数の参照は <code>{}</code> があってもなくても良かったのですが、配列の要素の参照の場合は
    <code>{}</code> が必要です。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="c"># 複合代入</span>
<span class="nv">array</span><span class="o">=(</span>item1 item2 <span class="s1">'item3 item4'</span> item5<span class="o">)</span>

<span class="c"># 参照</span>
<span class="nb">echo</span> <span class="s1">'${array[0]}'</span>: <span class="k">${</span><span class="nv">array</span><span class="p">[0]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="s1">'${array[1]}'</span>: <span class="k">${</span><span class="nv">array</span><span class="p">[1]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="s1">'${array[2]}'</span>: <span class="k">${</span><span class="nv">array</span><span class="p">[2]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="s1">'${array[3]}'</span>: <span class="k">${</span><span class="nv">array</span><span class="p">[3]</span><span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">$</span><span class="o">{</span>array[0]<span class="o">}</span>: item1
<span class="gp">$</span><span class="o">{</span>array[1]<span class="o">}</span>: item2
<span class="gp">$</span><span class="o">{</span>array[2]<span class="o">}</span>: item3 item4
<span class="gp">$</span><span class="o">{</span>array[3]<span class="o">}</span>: item5
</code></pre>
    </div>
  </div>
  <h2>
    <span id="6-3-配列の要素数の取得" class="fragment"></span><a
      href="#6-3-%E9%85%8D%E5%88%97%E3%81%AE%E8%A6%81%E7%B4%A0%E6%95%B0%E3%81%AE%E5%8F%96%E5%BE%97"><i
        class="fa fa-link"></i></a>(6-3) 配列の要素数の取得
  </h2>
  <p>配列の要素数は <code>${#変数名[@]}</code> という構文で取得できます。未定義の要素はカウントされません。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">array</span><span class="o">=(</span>item1 item2 <span class="s1">'item3 item4'</span> item5<span class="o">)</span>
<span class="nb">echo</span> <span class="k">${#</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">4
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="6-4-配列へのインデックスを利用した代入" class="fragment"></span><a
      href="#6-4-%E9%85%8D%E5%88%97%E3%81%B8%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E4%BB%A3%E5%85%A5"><i
        class="fa fa-link"></i></a>(6-4) 配列へのインデックスを利用した代入
  </h2>
  <p>
    シェルスクリプトでは配列の要素は連続している必要はなく、途中に空きのある配列も作成できます。途中に空きのある配列を作成する場合は、複合代入の際に要素の部分で
    <code>[インデック]=値</code> と書きます。また、既存の配列の要素を変更するには、 <code>変数名[インデックス]=値</code> と書きます。未定義の配列に対して
    <code>変数名[インデックス]=値</code> を使うと、複合代入をしなくても空きのある配列が作成できます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="c"># 複合代入の際にインデックスを指定して値を入れることで、空きのある配列を作成可能</span>
<span class="nv">array</span><span class="o">=(</span>item0 <span class="o">[</span>2]<span class="o">=</span>item2 <span class="o">[</span>4]<span class="o">=</span>item4<span class="o">)</span>
<span class="nb">echo</span> <span class="k">${#</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span> <span class="c"># 3つしか値が入っていないので要素数は3となる</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[0]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[1]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[2]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[3]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[4]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="nt">-----------------</span>

<span class="c"># 既存の配列の要素を書き換える</span>
array[1]<span class="o">=</span>item1    <span class="c"># 未定義だったインデックスに値を代入する</span>
array[2]<span class="o">=</span>         <span class="c"># 既存のインデックスを空文字にする</span>
<span class="nb">echo</span> <span class="k">${#</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span> <span class="c"># [1] に値が入ったので要素数は4となる</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[0]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[1]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[2]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[3]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">array</span><span class="p">[4]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="nt">-----------------</span>

<span class="c"># 未定義の配列にいきなりインデックス指定で要素を代入できる</span>
new_array[3]<span class="o">=</span>item3
<span class="nb">echo</span> <span class="k">${#</span><span class="nv">new_array</span><span class="p">[@]</span><span class="k">}</span>    
<span class="nb">echo</span> <span class="k">${</span><span class="nv">new_array</span><span class="p">[0]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">new_array</span><span class="p">[1]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">new_array</span><span class="p">[2]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">new_array</span><span class="p">[3]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">new_array</span><span class="p">[4]</span><span class="k">}</span>
<span class="nb">echo</span> <span class="nt">-----------------</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">3
item0

item2

item4
-----------------
4
item0
item1


item4
-----------------
1



item3

-----------------
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="6-5-配列の全ての要素の参照" class="fragment"></span><a
      href="#6-5-%E9%85%8D%E5%88%97%E3%81%AE%E5%85%A8%E3%81%A6%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E5%8F%82%E7%85%A7"><i
        class="fa fa-link"></i></a>(6-5) 配列の全ての要素の参照
  </h2>
  <p>引数と同じく <code>@</code>, <code>*</code>
    で全ての要素を参照可能ですが、想定通りの動作を保証するためにダブルクォーテーションで囲った <code>"${変数名[@]}"</code>, <code>"${変数名[*]}"</code>
    を使うのが良いでしょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">array</span><span class="o">=(</span>item1 item2 <span class="s1">'item3 item4'</span> item5<span class="o">)</span>

<span class="k">function </span>echo_array_items<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="nv">$1</span>
  <span class="nb">echo</span> <span class="nv">$2</span>
  <span class="nb">echo</span> <span class="nv">$3</span>
  <span class="nb">echo</span> <span class="nv">$4</span>
  <span class="nb">echo</span> <span class="nv">$5</span>
  <span class="nb">echo</span> <span class="nt">-----------------------</span>
<span class="o">}</span>

<span class="nb">echo </span>Use <span class="s1">'"${array[@]}"'</span>
echo_array_items <span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> <span class="c"># echo_array_items "${array[0]}" "${array[1]}" ... と同じ</span>

<span class="nb">echo </span>Use <span class="s1">'"${array[*]}"'</span>
echo_array_items <span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[*]</span><span class="k">}</span><span class="s2">"</span> <span class="c"># echo_array_items "${array[0]} ${array[1]} ..." と同じ</span>

<span class="nb">echo </span>Use <span class="s1">'${array[@]}'</span>
echo_array_items <span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span>

<span class="nb">echo </span>Use <span class="s1">'${array[*]}'</span>
echo_array_items <span class="k">${</span><span class="nv">array</span><span class="p">[*]</span><span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">Use "$</span><span class="o">{</span>array[@]<span class="o">}</span><span class="s2">"
</span><span class="go">item1
item2
item3 item4
item5

-----------------------
</span><span class="gp">Use "$</span><span class="o">{</span>array[<span class="k">*</span><span class="o">]}</span><span class="s2">"
</span><span class="go">item1 item2 item3 item4 item5




-----------------------
</span><span class="gp">Use $</span><span class="o">{</span>array[@]<span class="o">}</span>
<span class="go">item1
item2
item3
item4
item5
-----------------------
</span><span class="gp">Use $</span><span class="o">{</span>array[<span class="k">*</span><span class="o">]}</span>
<span class="go">item1
item2
item3
item4
item5
-----------------------
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="6-6-配列への要素の追加" class="fragment"></span><a
      href="#6-6-%E9%85%8D%E5%88%97%E3%81%B8%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E8%BF%BD%E5%8A%A0"><i
        class="fa fa-link"></i></a>(6-6) 配列への要素の追加
  </h2>
  <p</code> と組み合わせることで、配列に要素を追加できます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nv">array</span><span class="o">=(</span>item1 item2 item3<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># 先頭に追加</span>
<span class="nv">array2</span><span class="o">=(</span>item_a item_b <span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">array2</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># 末尾に追加</span>
<span class="nv">array3</span><span class="o">=(</span><span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> item_c item_d<span class="o">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">array3</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># 自身の末尾に追加</span>
array+<span class="o">=(</span>item_e item_f<span class="o">)</span> <span class="c"># array=("${array[@]}" item_e item_f) と同じ</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">item1 item2 item3
item_a item_b item1 item2 item3
item1 item2 item3 item_c item_d
item1 item2 item3 item_e item_f
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="6-7-値の存在するインデックスの取得" class="fragment"></span><a
      href="#6-7-%E5%80%A4%E3%81%AE%E5%AD%98%E5%9C%A8%E3%81%99%E3%82%8B%E3%82%A4%E3%83%B3%E3%83%87%E3%83%83%E3%82%AF%E3%82%B9%E3%81%AE%E5%8F%96%E5%BE%97"><i
        class="fa fa-link"></i></a>(6-7) 値の存在するインデックスの取得
  </h2>
  <p><code>${!変数名[@]}</code> で配列の中で値の存在するインデックスを取得できます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">array</span><span class="o">=(</span>item0 <span class="o">[</span>2]<span class="o">=</span>item2 <span class="o">[</span>4]<span class="o">=</span>item4<span class="o">)</span>
<span class="nb">echo</span> <span class="k">${</span><span class="p">!array[@]</span><span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">0 2 4
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>シェルスクリプトにおける連想配列について</strong><br>
        シェルスクリプトでも他の言語で言うハッシュやマップのような機能である連想配列が使用可能です。ただし、 <code>bash</code>
        のバージョンが4未満の場合は連想配列を使用できません。</p>
      <details>
        <summary>詳細</summary>
        <div>
          <p>使用感はほぼ配列と同じなので、使い方は簡単にまとめておきます。</p>
          <ul>
            <li>
              <strong>宣言</strong><br>
              連想配列は他の変数や配列のように暗黙的な宣言ができません。代わりに <code>declare -A</code> で明示的に宣言する必要があります。先に
              <code>declare -A 変数名</code> で変数を宣言しておいて、後から複合代入することも可能ですし、
              <code>declare -A 変数名=([キー1]=値1 [キー2]=値2 ...)</code> のように宣言と代入を同時に行うことも可能です。
            </li>
            <li>
              <strong>参照</strong><br>
              参照の仕方は配列と似ていて、<code>${変数名[キー名]}</code> です。 <code>{}</code> は省略不可です。
            </li>
            <li>
              <strong>代入</strong><br>
              代入も配列と同様 <code>変数名[キー名]=値</code> です。
            </li>
            <li>
              <strong>全ての値の参照</strong><br>
              全ての値の参照は配列と全く同じで <code>"${array[@]}"</code> です。ただし、代入順は維持されないことに注意してください。
            </li>
            <li>
              <strong>キーの一覧の取得</strong><br>
              連想配列には配列のように空の要素というものはないため、 <code>${!変数名[@]}</code> ではキーの一覧が取得できます。
            </li>
          </ul>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>
<span class="c"># 宣言</span>
<span class="nb">declare</span> <span class="nt">-A</span> <span class="nv">price</span><span class="o">=([</span>water]<span class="o">=</span>100 <span class="o">[</span>bread]<span class="o">=</span>160 <span class="o">[</span>vegetable]<span class="o">=</span>200<span class="o">)</span>

<span class="c"># 代入</span>
price[beef]<span class="o">=</span>360

<span class="c"># 参照</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">price</span><span class="p">[water]</span><span class="k">}</span>
<span class="c"># キーの一覧</span>
<span class="nb">echo</span> <span class="k">${</span><span class="p">!price[@]</span><span class="k">}</span>
<span class="c"># 全ての値の参照(キー順になっていることに注意)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">price</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span> 
<span class="c"># 要素数</span>
<span class="nb">echo</span> <span class="k">${#</span><span class="nv">price</span><span class="p">[@]</span><span class="k">}</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">100
160 360 100 200
bread beef water vegetable
4
</span></code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <h1>
    <span id="7-シェルスクリプトで条件分岐をしてみよう" class="fragment"></span><a
      href="#7-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>7. シェルスクリプトで条件分岐をしてみよう
  </h1>
  <h2>
    <span id="7-1-if-による条件分岐の書き方" class="fragment"></span><a
      href="#7-1-if-%E3%81%AB%E3%82%88%E3%82%8B%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i
        class="fa fa-link"></i></a>(7-1) <code>if</code> による条件分岐の書き方
  </h2>
  <p>if 文の一番単純な書き方は以下のようになります。 if の逆をとった文字である <code>fi</code> により if
    文の終わる場所を明示する必要があります。普段あまり使わない文字列なので間違えないように気をつけましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">if </span>条件<span class="p">;</span> <span class="k">then
    </span>条件が真の場合の処理
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <p>以下も可能です。</p>
  <ul>
    <li>条件が真のときに複数の処理を行う</li>
    <li>
      <code>elif</code> 句により条件と処理を追加
    </li>
    <li>
      <code>else</code> 句により条件が全て偽であった時の処理を追加
    </li>
    <li>if 文自体を入れ子にする</li>
  </ul>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">if </span>条件1<span class="p">;</span> <span class="k">then
  </span>条件1が真の場合の処理1
  条件1が真の場合の処理2
<span class="k">elif </span>条件2<span class="p">;</span> <span class="k">then
  </span>条件2が真の場合の処理
<span class="k">elif </span>条件3<span class="p">;</span> <span class="k">then
  </span>条件3が真の場合の処理
  <span class="k">if </span>条件4<span class="p">;</span> <span class="k">then
    </span>条件3, 4が真の場合の処理
  <span class="k">fi
else
  </span>上記全ての条件が偽である場合の処理
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong><code>if</code> による条件分岐の書き方の詳細</strong><br>
        <code>if 条件</code> はコマンドとして扱われるので、<code>if 条件</code> の後ろにはコマンドの終わりを表す記号が必要になります。<a
          href="#(1-6)-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">(1-6)</a>
        で解説したように、コマンドは <code>;</code> または改行で区切ることができます。上記の例のように <code>;</code> を付けて同じ行に
        <code>then</code> を続けて書くこともできますし、以下のように改行で区切って <code>then</code> を別の行に分けることもできます。
      </p>
      <div class="code-frame" data-lang="bash">
        <div class="highlight">
          <pre><code><span class="k">if </span>条件
<span class="k">then
    </span>条件が真の場合の処理
<span class="k">fi</span>
</code></pre>
        </div>
      </div>
      <p>ただし、 <code>;</code> を付けて同じ行に <code>then</code>
        を続けて書く書き方の方が一般的なので、そちらの書き方で書くことをオススメします。</p>
    </div>
  </div>
  <h2>
    <span id="7-2-if-文の条件にはコマンドを使用する" class="fragment"></span><a
      href="#7-2-if-%E6%96%87%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%81%AB%E3%81%AF%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B"><i
        class="fa fa-link"></i></a>(7-2) if 文の条件にはコマンドを使用する
  </h2>
  <p>一般的なプログラミング言語では if 文の条件として真偽値を返す式を書きますが、シェルスクリプトでは if
    文の条件としてコマンドを書き、そのコマンドの終了ステータスによって条件分岐を制御します。終了ステータスが 0 であれば真、0 以外であれば偽として判定します。これは<a
      href="#(5-2)-%60$?%60">(5-2)</a>で解説したように、Linuxのコマンドは終了ステータスとして、成功の場合は 0 を、失敗の場合は 0
    以外を返すようになっているためです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">if </span><span class="nb">grep</span> <span class="nt">-n</span> <span class="nb">test </span>test.txt<span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="nv">$?</span>
  <span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo</span> <span class="nv">$?</span>
  <span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="c"># test.txt に test という文字列が含まれている場合</span>
<span class="nv">$ </span>./test.sh
1:test is writen <span class="c"># grep による出力</span>
0                <span class="c"># grep コマンドの終了ステータス</span>
success          

<span class="c"># test.txt に test という文字列が含まれていない場合</span>
<span class="nv">$ </span>./test.sh
1                <span class="c"># grep は対象ファイルに検索文字列が含まれていないと終了ステータスとしては失敗となる</span>
fail 
</code></pre>
    </div>
  </div>
  <h2>
    <span id="7-3--コマンドで-if-文の条件を書いてみよう" class="fragment"></span><a
      href="#7-3--%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7-if-%E6%96%87%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(7-3) <code>[</code> コマンドで if 文の条件を書いてみよう
  </h2>
  <p>if 文の条件として <code>[</code> コマンドがよく使用されます。<code>[</code>
    は単なる記号ではなく、コマンドとして機能し、別名の <code>test</code> コマンドと同じ動作をします。<code>[</code> や <code>test</code>
    コマンドは引数に演算子を渡すと、文字列や数値の比較をしたり、ファイルの存在を判定してくれたりします。そして、判定の結果が真であれば 0、偽であれば 1
    を終了ステータスとして返します。見た目のわかりやすさから、 <code>test</code> コマンドより <code>[</code> コマンドの方がよく使用されます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">test</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"test"</span>
<span class="nb">echo</span> <span class="s1">'test コマンドの終了ステータス'</span>: <span class="nv">$?</span>

<span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"test"</span> <span class="o">]</span>
<span class="nb">echo</span> <span class="s1">'[ コマンドの終了ステータス'</span>:<span class="nv">$?</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"test"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh <span class="nb">test</span>
<span class="go">test コマンドの終了ステータス: 0
[ コマンドの終了ステータス: 0
success

</span><span class="gp">$</span><span class="w"> </span>./test.sh xxx
<span class="go">test コマンドの終了ステータス: 1
[ コマンドの終了ステータス: 1
fail
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p><strong><code>[</code> コマンドの書き方の注意点</strong></p>
      <ul>
        <li>
          <code>[</code> をコマンドとして認識させるために、if との間、第1引数との間にそれぞれスペースを空ける。
        </li>
        <li>演算子と他の引数との間にもスペースを空ける。</li>
        <li>最後の引数として <code>]</code> を渡す。</li>
        <li>
          <code>]</code> を単体の引数として認識させるために、 <code>]</code> の前にもスペースを空ける。
        </li>
      </ul>
    </div>
  </div>
  <h2>
    <span id="7-4--コマンドの演算子の紹介" class="fragment"></span><a
      href="#7-4--%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%AE%E7%B4%B9%E4%BB%8B"><i
        class="fa fa-link"></i></a>(7-4) <code>[</code> コマンドの演算子の紹介
  </h2>
  <p><code>[</code>, <code>test</code>
    コマンドには条件判定のために様々な演算子が用意されています。以下で使用用途に分けて紹介していきます。</p>
  <h3>
    <span id="文字列の比較" class="fragment"></span><a href="#%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E6%AF%94%E8%BC%83"><i
        class="fa fa-link"></i></a>文字列の比較
  </h3>
  <table>
    <thead>
      <tr>
        <th>演算子</th>
        <th>判定結果が真になる条件</th>
        <th>頻出度</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <em>str</em> (演算子なし)
        </td>
        <td>
          <em>str</em> が空文字列でも未定義でもない
        </td>
        <td>★☆☆</td>
      </tr>
      <tr>
        <td>-n <em>str</em>
        </td>
        <td>
          <em>str</em> が空文字列でない(未定義の場合も真)
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>-z <em>str</em>
        </td>
        <td>
          <em>str</em> が空文字列である
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>str1</em> = <em>str2</em>
        </td>
        <td>
          <em>str1</em> と <em>str2</em> が等しい
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>str1</em> == <em>str2</em>
        </td>
        <td>
          <em>str1</em> と <em>str2</em> が等しい (<code>=</code> と同じ)
        </td>
        <td>★☆☆</td>
      </tr>
      <tr>
        <td>
          <em>str1</em> != <em>str2</em>
        </td>
        <td>
          <em>str1</em> と <em>str2</em> が等しくない
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>str1</em> &lt; <em>str2</em>
        </td>
        <td>
          <em>str1</em> が <em>str2</em> よりも辞書順で前にある
        </td>
        <td>★★☆</td>
      </tr>
      <tr>
        <td>
          <em>str1</em> &gt; <em>str2</em>
        </td>
        <td>
          <em>str1</em> が <em>str2</em> よりも辞書順で後にある
        </td>
        <td>★★☆</td>
      </tr>
    </tbody>
  </table>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p><code>&lt;</code>, <code>&gt;</code> は bash
        にとって別の意味（リダイレクト）の記号なので、 <code>[</code> コマンドに引数として渡す際は文字列として渡すために <code>'&lt;'</code>,
        <code>"&gt;"</code>, <code>\&gt;</code> のようにクォーティング（エスケープ）する必要があります。
      </p>
    </div>
  </div>
  <h3>
    <span id="整数の比較" class="fragment"></span><a href="#%E6%95%B4%E6%95%B0%E3%81%AE%E6%AF%94%E8%BC%83"><i
        class="fa fa-link"></i></a>整数の比較
  </h3>
  <table>
    <thead>
      <tr>
        <th>演算子</th>
        <th>意味</th>
        <th>判定結果が真になる条件</th>
        <th>頻出度</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <em>int1</em> -eq <em>int2</em>
        </td>
        <td>equal</td>
        <td>
          <em>int1</em> と <em>int2</em> が等しい
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>int1</em> -ne <em>int2</em>
        </td>
        <td>not equal</td>
        <td>
          <em>int1</em> と <em>int2</em> が等しくない
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>int1</em> -lt <em>int2</em>
        </td>
        <td>less than</td>
        <td>
          <em>int1</em> が <em>int2</em> より小さい
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>int1</em> -le <em>int2</em>
        </td>
        <td>less than or equal</td>
        <td>
          <em>int1</em> が <em>int2</em> 以下
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>int1</em> -gt <em>int2</em>
        </td>
        <td>greater than</td>
        <td>
          <em>int1</em> が <em>int2</em> より大きい
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>
          <em>int1</em> -ge <em>int2</em>
        </td>
        <td>greater than or equal</td>
        <td>
          <em>int1</em> が <em>int2</em> 以上
        </td>
        <td>★★★</td>
      </tr>
    </tbody>
  </table>
  <h3>
    <span id="ファイルに関する評価" class="fragment"></span><a
      href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AB%E9%96%A2%E3%81%99%E3%82%8B%E8%A9%95%E4%BE%A1"><i
        class="fa fa-link"></i></a>ファイルに関する評価
  </h3>
  <p>ファイルに関する評価には多くの演算子が用意されていますが、ここではよく使われる演算子に絞って紹介します。</p>
  <table>
    <thead>
      <tr>
        <th>演算子</th>
        <th>判定結果が真になる条件</th>
        <th>頻出度</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>-d <em>file</em>
        </td>
        <td>
          <em>file</em> が存在し、ディレクトリである
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>-e <em>file</em>
        </td>
        <td>
          <em>file</em> が存在する(<code>-a</code> と同じ)
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>-f <em>file</em>
        </td>
        <td>
          <em>file</em> が存在し、通常のファイルである
        </td>
        <td>★★★</td>
      </tr>
      <tr>
        <td>-r <em>file</em>
        </td>
        <td>
          <em>file</em> が存在し、読み取り権限が与えられている
        </td>
        <td>★★☆</td>
      </tr>
      <tr>
        <td>-w <em>file</em>
        </td>
        <td>
          <em>file</em> が存在し、書き込み権限が与えられている
        </td>
        <td>★★☆</td>
      </tr>
      <tr>
        <td>-x <em>file</em>
        </td>
        <td>
          <em>file</em> が存在し、実行権限が与えられている
        </td>
        <td>★★☆</td>
      </tr>
    </tbody>
  </table>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <details>
        <summary><b>その他のファイルに関する評価のための演算子</b></summary>
        <div>
          <table>
            <thead>
              <tr>
                <th>演算子</th>
                <th>判定結果が真になる条件</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>-b <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、ブロック特殊ファイル<sup><a href="#fn-special_file" id="fnref-special_file">1</a></sup>である
                </td>
              </tr>
              <tr>
                <td>-c <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、キャラクター特殊ファイル<sup><a href="#fn-special_file"
                      id="fnref-special_file-2">1</a></sup>である
                </td>
              </tr>
              <tr>
                <td>-g <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、SGID(特殊なアクセス権)<sup><a href="#fn-sgid" id="fnref-sgid">2</a></sup>が設定されている
                </td>
              </tr>
              <tr>
                <td>-h <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、シンボリックリンクである<sup><a href="#fn-symbolic_link"
                      id="fnref-symbolic_link">3</a></sup>(<code>-L</code> と同じ)
                </td>
              </tr>
              <tr>
                <td>-k <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、スティッキービット<sup><a href="#fn-sticky_bit" id="fnref-sticky_bit">4</a></sup>が設定されている
                </td>
              </tr>
              <tr>
                <td>-p <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、名前付きパイプである
                </td>
              </tr>
              <tr>
                <td>-s <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、ファイルサイズが 0 より大きい
                </td>
              </tr>
              <tr>
                <td>-u <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、SUID(特殊なアクセス権)<sup><a href="#fn-sgid" id="fnref-sgid-2">2</a></sup>が設定されている
                </td>
              </tr>
              <tr>
                <td>-G <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、ファイルのグループが現在のユーザーのグループと一致する
                </td>
              </tr>
              <tr>
                <td>-L <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、シンボリックリンクである<sup><a href="#fn-symbolic_link"
                      id="fnref-symbolic_link-2">3</a></sup>(<code>-k</code> と同じ)
                </td>
              </tr>
              <tr>
                <td>-O <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、ファイルの所有者が現在のユーザーと一致する
                </td>
              </tr>
              <tr>
                <td>-S <em>file</em>
                </td>
                <td>
                  <em>file</em> が存在し、ソケットである
                </td>
              </tr>
              <tr>
                <td>
                  <em>file1</em> -ef <em>file2</em>
                </td>
                <td>
                  <em>file1</em> と <em>file2</em> が同じ物理的ファイルを指している
                </td>
              </tr>
              <tr>
                <td>
                  <em>file1</em> -nt <em>file2</em>
                </td>
                <td>
                  <em>file1</em> の変更時刻が <em>file2</em> より新しい
                </td>
              </tr>
              <tr>
                <td>
                  <em>file1</em> -ot <em>file2</em>
                </td>
                <td>
                  <em>file1</em> の変更時刻が <em>file2</em> より古い
                </td>
              </tr>
              <tr>
                <td>-t <em>file descriptor</em>
                </td>
                <td>指定された番号のファイルディスクリプタが端末に接続されている</td>
              </tr>
            </tbody>
          </table>
        </div>
      </details>
    </div>
  </div>
  <h3>
    <span id="演算子の結合" class="fragment"></span><a href="#%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%AE%E7%B5%90%E5%90%88"><i
        class="fa fa-link"></i></a>演算子の結合
  </h3>
  <p>以上の演算子は次の演算子によって条件を組み合わせることが可能です。</p>
  <table>
    <thead>
      <tr>
        <th>演算子</th>
        <th>意味</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <em>expression1</em> -a <em>expression2</em>
        </td>
        <td>
          <em>expression1</em> と <em>expression2</em> の両方の条件が真の場合に真(AND)
        </td>
      </tr>
      <tr>
        <td>
          <em>expression1</em> -o <em>expression2</em>
        </td>
        <td>
          <em>expression1</em> と <em>expression2</em> のどちらかの条件が真の場合に真(OR)
        </td>
      </tr>
      <tr>
        <td>(<em>expression</em>)</td>
        <td>条件式をグループ化する際に用いる</td>
      </tr>
    </tbody>
  </table>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p><code>()</code> は bash にとって別の意味の記号なので、 <code>[</code>
        コマンドに引数として渡す際は、文字列として渡すために <code>[ \( "$str" = "test" \) ]</code>のようにクォーティング（エスケープ）する必要があります。
      </p>
    </div>
  </div>
  <p>演算子の結合は以下のように書きます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[</span> <span class="se">\(</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"a"</span>  <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"b"</span> <span class="se">\)</span> <span class="nt">-a</span> <span class="nt">-f</span> test.txt <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s1">'第１引数がaまたは第２引数がbで、かつtest.txtが存在しています！'</span>
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>test.txt
<span class="gp">$</span><span class="w"> </span>./test.sh a c
<span class="go">第１引数がaまたは第２引数がbで、かつtest.txtが存在しています！
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="7-5-より安全な---を使って条件分岐してみよう" class="fragment"></span><a
      href="#7-5-%E3%82%88%E3%82%8A%E5%AE%89%E5%85%A8%E3%81%AA---%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(7-5) より安全な <code>[[ ]]</code> を使って条件分岐してみよう
  </h2>
  <p><code>[</code>, <code>test</code> コマンドと似た構文として
    <code>[[ ]]</code> があります。<code>[[ ]]</code> の中では、基本的には <code>[ ]</code>
    と同じ演算子が使えますが、以下のようにいくつかの違いがあります。<code>[[ ]]</code>
    の方がシェルスクリプト特有の制限が少なく、シンブルに記述できて便利なため、こちらを使うことをオススメします。
  </p>
  <p><strong><code>&amp;&amp;</code>, <code>||</code>
      で条件式をよりシンプルに書ける</strong><br>
    <code>[[ ]]</code> の中ではAND演算子、OR演算子として <code>-a</code>, <code>-o</code> の代わりに
    <code>&amp;&amp;</code>, <code>||</code> を使用できます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">if</span> <span class="o">[[</span> <span class="o">(</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"a"</span>  <span class="o">||</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"b"</span> <span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="nt">-f</span> test.txt <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s1">'第１引数がaまたは第２引数がbで、かつtest.txtが存在しています！'</span>
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>tuoch test.txt
<span class="gp">$</span><span class="w"> </span>./test.sh a c
<span class="go">第１引数がaまたは第２引数がbで、かつtest.txtが存在しています！
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong><code>&amp;&amp;</code>, <code>||</code>
          について</strong><br>
        元々 <code>&amp;&amp;</code>, <code>||</code> は複数のコマンドをAND演算、
        OR演算で連結するための演算子ですが、<code>[[ ]]</code> では専用の機構でこれらの記号を特別扱いしています。</p>
      <details>
        <summary>詳細</summary>
        <div>
          <ul>
            <li>
              <code>&amp;&amp;</code><br>
              <code>コマンド1 &amp;&amp; コマンド2</code>
              のように書くと、まずコマンド1を実行して、コマンド1が成功したら（コマンド1の終了ステータスが0だったら)コマンド2を続けて実行します。以下の例では
              <code>mkdir test</code> が権限の問題などで失敗した場合には、後ろの <code>cd test</code> コマンドは実行されません。
            </li>
          </ul>
          <div class="code-frame" data-lang="shell-session">
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir test</span> <span class="o">&amp;&amp;</span> <span class="nb">cd test</span>
</code></pre>
            </div>
          </div>
          <ul>
            <li>
              <code>||</code><br>
              <code>コマンド1 || コマンド2</code>
              のように書くと、まずコマンド1を実行して、コマンド1が失敗したら（コマンド1の終了ステータスが0以外だったら)コマンド2を続けて実行します。以下の例では
              <code>cat test.txt</code> がファイルが存在せずに失敗した場合のみ、後ろの <code>touch test.txt</code>
              コマンドでファイルを新規作成します。
            </li>
          </ul>
          <div class="code-frame" data-lang="shell-session">
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>test.txt <span class="o">||</span> <span class="nb">touch </span>test.txt
</code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>

  <p><strong>単語分割されない</strong></p>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <details>
        <summary><code>[</code> コマンドにおける単語分割</summary>
        <div>
          <p>
            単語分割とは、後述の展開がコマンド内で行われた後、展開された文字列をスペース、タブ、改行によって複数の単語に区切る機能ことです。<br>
            <code>[</code> コマンドでは単語分割が行われるため、スペースを含む文字列を値としてもつ変数や、空文字の変数を <code>[</code>
            で比較するとエラーになります。
          </p>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="nv">$1</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$var</span> <span class="o">=</span> <span class="s1">'hoge fuga'</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh <span class="s1">'hoge fuga'</span>
<span class="go">./test.sh: line 4: [: too many arguments
fail

</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">./test.sh: line 4: [: =: unary operator expected
fail
</span></code></pre>
            </div>
          </div>
          <p</code>
            で変数をクォートしていれば、その内側では単語分割は行われません。変数の間にスペースが含まれるかどうかは事前にわからないことが多いので、 <code>[ ]</code>
            の中では変数を常にクォートしておくことをオススメします。</p>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="nv">$1</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="o">=</span> <span class="s1">'hoge fuga'</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="c"># $var を "" でクォート</span>
  <span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh <span class="s1">'hoge fuga'</span>
<span class="go">success

</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">fail
</span></code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <p</code>
    でクォートしているかどうかに関わらず、変数の値を1つの文字列とみなします。そのため、クォートしていない変数の値がスペースを含んでいたり、空文字であったりしてもエラーになりません。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="nv">$1</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> <span class="o">=</span> <span class="s1">'hoge fuga'</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="c"># [[ ]] を使用</span>
  <span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh <span class="s1">'hoge fuga'</span>
<span class="go">success

</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">fail
</span></code></pre>
    </div>
  </div>
  <p><strong>パターンマッチができる</strong></p>
  <p><code>[[ ]]</code> 内で <code>=</code>, <code>==</code>,
    <code>!=</code> の右辺で <code>*</code> を用いると、パターン文字列とみなされます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span>hoge-fuga
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> <span class="o">==</span> hoge-<span class="k">*</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="c"># hoge-の後ろに任意の文字列というパターンに一致したら真</span>
  <span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">success
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <details>
        <summary><code>*</code> によるパターンマッチの詳細</summary>
        <div>
          <p><code>[[ ]]</code> 内の　<code>=</code>, <code>==</code>,
            <code>!=</code> の右辺で <code>*</code> をそのままの文字として扱いたい場合は、右辺を <code>""</code> でクォートします。
          </p>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span>hoge-fuga
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> <span class="o">==</span> <span class="s2">"hoge-*"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="c"># hoge-* という文字列と一致したら真</span>
  <span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">fail
</span></code></pre>
            </div>
          </div>
          <p>また、右辺に指定するパターンは文字列ではなく、変数で指定することも可能です。</p>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span>hoge-fuga
<span class="nv">pattern</span><span class="o">=</span><span class="s1">'hoge-*'</span>
<span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> <span class="o">==</span> <span class="nv">$pattern</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> <span class="c"># hoge-の後ろに任意の文字列というパターンに一致したら真</span>
  <span class="nb">echo </span>success
<span class="k">else
  </span><span class="nb">echo </span>fail
<span class="k">fi</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">success
</span></code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="7-7-case-による条件分岐の書き方" class="fragment"></span><a
      href="#7-7-case-%E3%81%AB%E3%82%88%E3%82%8B%E6%9D%A1%E4%BB%B6%E5%88%86%E5%B2%90%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i
        class="fa fa-link"></i></a>(7-7) <code>case</code> による条件分岐の書き方
  </h2>
  <p><code>case</code>
    は1つの文字列に対して複数のパターンを上から順番に照合していき、最初にマッチしたパターンに応じて処理を実行するための構文です。if 文と同様に、 case の逆をとった
    <code>esac</code> という文字列で case 文の終わりを明示する必要があります。また、各パターンに対しての処理の後に <code>;;</code>
    をつけるのを忘れがちなので注意しましょう。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">case</span> 文字列 <span class="k">in
  </span>パターン1<span class="p">)</span>
    処理1
    <span class="p">;;</span>
  パターン2<span class="p">)</span>
    処理2
    <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    処理3
    <span class="p">;;</span>
<span class="k">esac</span>
</code></pre>
    </div>
  </div>
  <p>case 文には以下の特徴があります。</p>
  <ul>
    <li>パターンにワイルドカード(<code>*</code>)を使用できる</li>
    <li>最後に <code>*)</code>
      というパターンを書くことで、それよりに前に書いた全てのパターンにマッチしなかったときの処理を書くことができる</li>
    <li>
      <code>|</code> を使うことで、複数のパターンに対して同一の処理をさせることができる
    </li>
  </ul>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">file</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$file</span><span class="s2">"</span> <span class="k">in</span>
  <span class="k">*</span>.csv<span class="p">)</span>
    <span class="nb">echo </span>this is csv
    <span class="p">;;</span>
  special-<span class="k">*</span> <span class="p">|</span> important-<span class="k">*</span><span class="p">)</span>
    <span class="nb">echo </span>this is special file
    <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">echo</span> <span class="s2">"Invalid file: </span><span class="nv">$file</span><span class="s2">"</span>
    <span class="p">;;</span>
<span class="k">esac</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh abc.csv
<span class="go">this is csv

</span><span class="gp">$</span><span class="w"> </span>./test.sh importand-paper.pdf
<span class="go">this is special file

</span><span class="gp">$</span><span class="w"> </span>./test.sh other.txt
<span class="go">Invalid fiel: other.txt
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="8-シェルスクリプトでループ処理を書いてみよう" class="fragment"></span><a
      href="#8-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>8. シェルスクリプトでループ処理を書いてみよう
  </h1>
  <h2>
    <span id="8-1-for-によるループ処理の書き方" class="fragment"></span><a
      href="#8-1-for-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i
        class="fa fa-link"></i></a>(8-1) <code>for</code> によるループ処理の書き方
  </h2>
  <p><code>for</code> を使うことで、単語リストに対してループ処理を行うことができます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">for </span>変数 <span class="k">in </span>単語リスト<span class="p">;</span> <span class="k">do
  </span>繰り返す処理
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <p>(5-4)</a>で解説した
    <code>"$@"</code>
    を用いることで、シェルスクリプトに渡された全引数に対して繰り返し処理を行えます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>arg <span class="k">in</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span> <span class="c"># for の後に続く変数名には $ をつけない</span>
    <span class="nb">echo</span> <span class="nv">$arg</span>       <span class="c"># 参照するときは $ をつける</span>
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh <span class="s1">'aaa bbb'</span> ccc ddd
<span class="go">aaa bbb
ccc
ddd
</span></code></pre>
    </div>
  </div>
  <p>また、<a
      href="(6-5)-%E9%85%8D%E5%88%97%E3%81%AE%E5%85%A8%E3%81%A6%E3%81%AE%E8%A6%81%E7%B4%A0%E3%81%AE%E5%8F%82%E7%85%A7">(6-5)</a>で解説した　<code>"${array[@]}"</code>
    を用いることで、配列の全要素に対して繰り返し処理を行えます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">array</span><span class="o">=(</span>aaa <span class="s1">'bbb ccc'</span> ddd<span class="o">)</span>
<span class="k">for </span>element <span class="k">in</span> <span class="s2">"</span><span class="k">${</span><span class="nv">array</span><span class="p">[@]</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do
    </span><span class="nb">echo</span> <span class="nv">$element</span>
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">aaa
bbb ccc
ddd
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="8-2-while-until-によるループ処理の書き方" class="fragment"></span><a
      href="#8-2-while-until-%E3%81%AB%E3%82%88%E3%82%8B%E3%83%AB%E3%83%BC%E3%83%97%E5%87%A6%E7%90%86%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9"><i
        class="fa fa-link"></i></a>(8-2) <code>while</code>, <code>until</code> によるループ処理の書き方
  </h2>
  <p><code>while</code> を使うことで、指定した条件が真である限り処理を繰り返すことができます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">while </span>条件<span class="p">;</span> <span class="k">do
  </span>繰り返す処理
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <p>条件部分には if 文と同様に、 <code>[</code> コマンドや <code>[[ ]]</code>
    構文も使えます。条件部分のコマンドを実行した結果終了ステータスが0であれば真とみなされ、処理が続行されます。条件部分の終了ステータスが0以外だと、偽とみなされ、その時点でループ処理は止まります。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">while</span> <span class="o">[[</span> <span class="nv">$# </span><span class="nt">-gt</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nv">$1</span>
  <span class="nb">shift
</span><span class="k">done</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh aaa bbb ccc
<span class="go">aaa
bbb
ccc
</span></code></pre>
    </div>
  </div>
  <p><code>until</code> は <code>while</code>
    の逆で、指定した条件が偽である限り処理を繰り返します。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">until</span> <span class="o">[[</span> <span class="nv">$# </span><span class="nt">-eq</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="nv">$1</span>
  <span class="nb">shift
</span><span class="k">done</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh aaa bbb ccc
<span class="go">aaa
bbb
ccc
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="9-関数を使って処理をまとめてみよう" class="fragment"></span><a
      href="#9-%E9%96%A2%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E5%87%A6%E7%90%86%E3%82%92%E3%81%BE%E3%81%A8%E3%82%81%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>9. 関数を使って処理をまとめてみよう
  </h1>
  <h2>
    <span id="9-1-関数の定義" class="fragment"></span><a href="#9-1-%E9%96%A2%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9"><i
        class="fa fa-link"></i></a>(9-1)
    関数の定義
  </h2>
  <p>
    シェルスクリプトが複雑になってきたら、ある程度のまとまりで処理を分けることで見通しをよくすることを考えましょう。その際に使えるのが関数です。関数は以下のように定義します。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">function </span>関数名<span class="o">()</span> 
<span class="o">{</span>
  処理
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <p>1行目の <code>function 関数名()</code> の部分は () を抜いて
    <code>function 関数名</code> と書くこともできます。また、function を抜いた <code>関数名()</code>
    だけでも関数を定義できます。しかし、関数の定義とわかりやすいように上で紹介した <code>function 関数名()</code> を使うのをオススメします。
  </p>
  <h2>
    <span id="9-2-関数内のみで有効なローカル変数の定義" class="fragment"></span><a
      href="#9-2-%E9%96%A2%E6%95%B0%E5%86%85%E3%81%AE%E3%81%BF%E3%81%A7%E6%9C%89%E5%8A%B9%E3%81%AA%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0%E3%81%AE%E5%AE%9A%E7%BE%A9"><i
        class="fa fa-link"></i></a>(9-2) 関数内のみで有効なローカル変数の定義
  </h2>
  <p>bash
    の変数は特に指定しない限りシェルスクリプト全体で有効なグローバル変数となります。これは変数を関数内で定義した場合も同様です。一般に、グローバル変数は有効範囲が広すぎて意図しない動作を招きやすいことから、関数内ではローカル変数を使うことが推奨されます。bash
    でローカル変数を定義するには変数名の前に <code>local</code> を付けます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">function </span>test_func<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span>var1
  <span class="nv">var1</span><span class="o">=</span>aaa

  <span class="nb">local </span><span class="nv">var2</span><span class="o">=</span>bbb <span class="c"># 定義と同時に代入することも可能</span>
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>ローカル変数の特徴</strong></p>
      <ul>
        <li>
          関数外で同じ変数名のグローバル変数が定義されていても、関数内ではローカル変数の方の値が有効。ローカル変数の値を変更しても、関数外の同名のグローバル変数の値は変わらない。</li>
        <li>
          関数から関数を呼び出した場合は、呼び出し元関数のローカル変数は呼び出し先関数でも有効。ただし、呼び出し先関数で呼び出し元関数と同じ名前のローカル変数を使用している場合はそちらが優先される。
        </li>
      </ul>
      <details>
        <summary>動作例</summary>
        <div>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>echo_value1<span class="o">()</span> 
<span class="o">{</span>
  <span class="nb">local </span><span class="nv">var1</span><span class="o">=</span>local1
  <span class="nb">echo</span> <span class="s1">'echo_value1:$var1:1:'</span> <span class="nv">$var1</span>

  <span class="nb">echo</span> <span class="s1">'echo_value1:$var2:1:'</span> <span class="nv">$var2</span>

<span class="o">}</span>

<span class="k">function </span>echo_value2<span class="o">()</span> 
<span class="o">{</span>
  <span class="nb">local </span><span class="nv">var1</span><span class="o">=</span>local2
  <span class="nb">echo</span> <span class="s1">'echo_value2:$var1:1:'</span> <span class="nv">$var1</span>
  
  <span class="nb">local </span><span class="nv">var2</span><span class="o">=</span>local2
  <span class="nb">echo</span> <span class="s1">'echo_value2:$var2:1:'</span> <span class="nv">$var2</span>

  echo_value1

  <span class="nb">echo</span> <span class="s1">'echo_value2:$var1:2:'</span> <span class="nv">$var1</span>
  <span class="nb">echo</span> <span class="s1">'echo_value2:$var2:2:'</span> <span class="nv">$var2</span>
<span class="o">}</span>

<span class="nv">var1</span><span class="o">=</span>global
<span class="nb">echo</span> <span class="s1">'global:$var1:1:'</span> <span class="nv">$var1</span>
<span class="nb">echo</span> <span class="s1">'global:$var2:1:'</span> <span class="nv">$var2</span>

echo_value2

<span class="nb">echo</span> <span class="s1">'global:$var1:2:'</span> <span class="nv">$var1</span>
<span class="nb">echo</span> <span class="s1">'global:$var2:2:'</span> <span class="nv">$var2</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">global:$</span>var1:1: global
<span class="gp">global:$</span>var2:1:
<span class="gp">echo_value2:$</span>var1:1: local2
<span class="gp">echo_value2:$</span>var2:1: local2
<span class="gp">echo_value1:$</span>var1:1: local1
<span class="gp">echo_value1:$</span>var2:1: local2
<span class="gp">echo_value2:$</span>var1:2: local2
<span class="gp">echo_value2:$</span>var2:2: local2
<span class="gp">global:$</span>var1:2: global
<span class="gp">global:$</span>var2:2:
</code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="9-3-関数で引数を扱う" class="fragment"></span><a
      href="#9-3-%E9%96%A2%E6%95%B0%E3%81%A7%E5%BC%95%E6%95%B0%E3%82%92%E6%89%B1%E3%81%86"><i
        class="fa fa-link"></i></a>(9-3) 関数で引数を扱う
  </h2>
  <p>
    コマンドやシェルスクリプトと同じように関数も引数を渡せます。引数として渡した値を関数内で参照するには、シェルスクリプトと同様に位置パラメータを使用します。また、位置パラメータの他に
    <code>$#</code> や <code>"$@"</code> も使用できます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>echo_self_args<span class="o">()</span>
<span class="o">{</span>
  <span class="nb">echo</span> <span class="nv">$1</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$2</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="k">${</span><span class="nv">3</span><span class="k">}</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">4</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="nv">$#</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>

echo_self_args arg1 arg2 <span class="s1">'arg3 arg4'</span> arg5
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">arg1
arg2
arg3 arg4
arg5
4
arg1 arg2 arg3 arg4 arg5
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="9-4-関数名を取得する" class="fragment"></span><a
      href="#9-4-%E9%96%A2%E6%95%B0%E5%90%8D%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><i
        class="fa fa-link"></i></a>(9-4) 関数名を取得する
  </h2>
  <p>(5-1)</a>で解説した通り、実行しているシェルスクリプトの名前は
    <code>$0</code>
    という特殊パラメータで取得できましたが、これは関数内かどうかに関わらず、常に実行しているシェルスクリプトの名前に展開されます。では、実行している関数の名前はどのように取得すればいいでしょうか？
  </p>
  <p>実行している関数の名前は<code>FUNCNAME</code> 変数によって取得できます。
    <code>FUNCNAME</code> は関数が呼び出されるたびに先頭にその関数名を追加していく配列です。そのため、 <code>${FUNCNAME[0]}</code>
    は常に実行中の関数の名前になります。<br>
    ログ等でどの関数で処理を実行したかを表示しておきたい場合に便利です。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>echo_value1<span class="o">()</span> 
<span class="o">{</span>
  <span class="nb">local </span><span class="nv">var1</span><span class="o">=</span>local1
  <span class="nb">echo</span> <span class="k">${</span><span class="nv">FUNCNAME</span><span class="p">[0]</span><span class="k">}</span> <span class="s1">':$var1:1:'</span> <span class="nv">$var1</span>

  <span class="nb">echo</span> <span class="k">${</span><span class="nv">FUNCNAME</span><span class="p">[0]</span><span class="k">}</span> <span class="s1">':$var2:1:'</span> <span class="nv">$var1</span>

<span class="o">}</span>

<span class="k">function </span>echo_value2<span class="o">()</span> 
<span class="o">{</span>
  <span class="nb">local </span><span class="nv">var1</span><span class="o">=</span>local2
  <span class="nb">echo</span> <span class="k">${</span><span class="nv">FUNCNAME</span><span class="p">[0]</span><span class="k">}</span> <span class="s1">':$var1:1:'</span> <span class="nv">$var1</span>
  
  <span class="nb">local </span><span class="nv">var2</span><span class="o">=</span>local2
  <span class="nb">echo</span> <span class="k">${</span><span class="nv">FUNCNAME</span><span class="p">[0]</span><span class="k">}</span> <span class="s1">':$var2:1:'</span> <span class="nv">$var1</span>

  echo_value1

  <span class="nb">echo</span> <span class="k">${</span><span class="nv">FUNCNAME</span><span class="p">[0]</span><span class="k">}</span> <span class="s1">':$var1:2:'</span> <span class="nv">$var1</span>
  <span class="nb">echo</span> <span class="k">${</span><span class="nv">FUNCNAME</span><span class="p">[0]</span><span class="k">}</span> <span class="s1">':$var2:2:'</span> <span class="nv">$var1</span>
<span class="o">}</span>

<span class="nv">var1</span><span class="o">=</span>global
<span class="nb">echo</span> <span class="s1">'global :$var1:1:'</span> <span class="nv">$var1</span>
<span class="nb">echo</span> <span class="s1">'global :$var2:1:'</span> <span class="nv">$var2</span>

echo_value2

<span class="nb">echo</span> <span class="s1">'global :$var1:2:'</span> <span class="nv">$var1</span>
<span class="nb">echo</span> <span class="s1">'global :$var2:2:'</span> <span class="nv">$var2</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">global :$</span>var1:1: global
<span class="gp">global :$</span>var2:1:
<span class="gp">echo_value2 :$</span>var1:1: local2
<span class="gp">echo_value2 :$</span>var2:1: local2
<span class="gp">echo_value1 :$</span>var1:1: local1
<span class="gp">echo_value1 :$</span>var2:1: local2
<span class="gp">echo_value2 :$</span>var1:2: local2
<span class="gp">echo_value2 :$</span>var2:2: local2
<span class="gp">global :$</span>var1:2: global
<span class="gp">global :$</span>var2:2:
</code></pre>
    </div>
  </div>
  <h2>
    <span id="9-5-関数の終了ステータス" class="fragment"></span><a
      href="#9-5-%E9%96%A2%E6%95%B0%E3%81%AE%E7%B5%82%E4%BA%86%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9"><i
        class="fa fa-link"></i></a>(9-5) 関数の終了ステータス
  </h2>
  <p>(5-2)</a>で解説した通り、シェルスクリプトの終了ステータスは
    <code>exit</code> コマンドで指定できましたが、関数の終了ステータスはどのように指定すればいいでしょうか？
  </p>
  <p>関数の終了ステータスを明示的に指定したい場合は <code>return</code>
    コマンドを使用します。<code>return</code> の引数を省略すると、<code>return</code>
    の直前で実行した関数の終了ステータスを返します。また、<code>return</code> 自体を省略したときは関数内で最後に実行したコマンドの終了ステータスが関数の終了ステータスとなります。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">function </span>return_test<span class="o">()</span>
<span class="o">{</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nt">-z</span> <span class="nv">$1</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s1">'arg1 is empty.'</span>
    <span class="k">return </span>1
  <span class="k">fi

  </span><span class="nb">echo</span> <span class="nv">$1</span>
<span class="o">}</span>

return_test <span class="nb">test
echo</span> <span class="s1">'終了ステータス'</span>: <span class="nv">$?</span>
<span class="nb">echo</span> <span class="nt">---</span>
return_test
<span class="nb">echo</span> <span class="s1">'終了ステータス'</span>: <span class="nv">$?</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">test
終了ステータス: 0
---
arg1 is empty.
終了ステータス: 1
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="10-リダイレクトヒアドキュメントパイプを使いこなそう" class="fragment"></span><a
      href="#10-%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E3%83%92%E3%82%A2%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%83%91%E3%82%A4%E3%83%97%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%9D%E3%81%86"><i
        class="fa fa-link"></i></a>10. リダイレクト・ヒアドキュメント・パイプを使いこなそう
  </h1>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>標準入出力について</strong><br>
        Linux では通常、標準入出力は以下に割り当てられています。</p>
      <table>
        <thead>
          <tr>
            <th>名前</th>
            <th>割当先</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>標準入力(stdin)</td>
            <td>キーボード</td>
          </tr>
          <tr>
            <td>標準出力(stdout)</td>
            <td>ターミナル画面</td>
          </tr>
          <tr>
            <td>標準エラー出力(sterr)</td>
            <td>ターミナル画面</td>
          </tr>
        </tbody>
      </table>
      <details>
        <summary>詳細</summary>
        <div>
          <p>Linux
            のコマンドは標準入出力を使用して動作しています。具体的には標準入力ファイルから入力を受け取り、コマンドの実行結果を標準出力ファイルに出力しています。また、エラーが起きた際はエラーメッセージを標準エラー出力という標準出力とは別のファイルに出力しています。この、標準入力、標準出力、標準エラー出力の3つを合わせて標準入出力と言います。<br>
            ここでファイルと言っているのは仮想的なもので、Linux
            カーネルではディスク、キーボード、ターミナル画面などのハードウェアを抽象化して、ファイルとして統一的に扱えるようにしています。（これらハードウェアを仮想化したファイルは
            <code>/dev</code> 配下に存在しています。）
          </p>
          <p>
            通常では標準出力も標準エラー出力も同じターミナル画面に割り当てられているため、シェルスクリプトで複数のコマンドを実行している途中でエラーが起きた際に、成功したコマンドの出力も、失敗したコマンドの出力も同じ画面上に出力されることになっています。
          </p>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="10-1-出力のリダイレクト機能を使ってみよう" class="fragment"></span><a
      href="#10-1-%E5%87%BA%E5%8A%9B%E3%81%AE%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(10-1) 出力のリダイレクト機能を使ってみよう
  </h2>
  <p>
    コマンド実行時に標準入出力の入力元、出力先を置き換えるシェルの機能をリダイレクトと言います。標準出力の出力先をターミナル画面から置き換えるには <code>&gt;</code>
    という記号を用います。</p>
  <p>以下の例では、本来ターミナル画面に標準出力される Hello という文字列の出力先を hello.txt
    に変更しています。その結果、ターミナルから test.sh を実行しても何も表示されません。また、 cat コマンドで hello.txt の中身を確認すると、確かに echo
    コマンドの出力がされていることがわかります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="nb">echo</span> <span class="s1">'Hello'</span> <span class="o">&gt;</span> hello.txt
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="nv">$ </span>./test.sh
<span class="c"># 何も出力されない</span>
<span class="nv">$ </span><span class="nb">cat </span>hello.txt
Hello
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>標準エラー出力のリダイレクト</strong><br>
        標準エラー出力のリダイレクトは <code>2&gt;</code> で行います。</p>
      <details>
        <summary>ファイルディスクリプタと出力リダイレクトの記法について</summary>
        <div>
          <p><code>&gt;</code> は実は <code>1&gt;</code> の省略形になります。この
            <code>1</code>
            はファイルディスクリプタと呼ばれる番号です。ファイルディスクリプタはプロセスから開かれた全てのファイルに割り当てられており、標準入出力には次の番号が割り当てられています。
          </p>
          <table>
            <thead>
              <tr>
                <th>名前</th>
                <th>ファイルディスクリプタの番号</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>標準入力</td>
                <td>0</td>
              </tr>
              <tr>
                <td>標準出力</td>
                <td>1</td>
              </tr>
              <tr>
                <td>標準エラー出力</td>
                <td>2</td>
              </tr>
            </tbody>
          </table>
          <p>リダイレクトの際、 <code>n&gt; ファイル</code>
            という書き方でファイルディスクリプタn番の出力先を指定したファイルに置き換えています。<code>n</code> を省略すると <code>1</code> とみなされるので、
            <code>&gt; ファイル</code> は <code>1&gt; ファイル</code> と同義であり、標準出力の出力先が指定したファイルに置換されるのです。
          </p>
          <p><code>1</code> の部分を <code>2</code>に変えて
            <code>2&gt;</code> とすることで標準エラー出力のリダイレクトになります。
          </p>
          <p><code>n&gt; ファイル</code> の記法についてですが、n と &gt;
            の間にスペースを入れて<code>n &gt;</code>とすることはできません。また、&gt; と ファイル
            の間にスペースを入れないことも可能ですが、見やすさのためにスペースを入れることをオススメします。</p>
        </div>
      </details>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong><code>&gt;&gt;</code> による追記</strong></p>
      <ul>
        <li>
          <code>&gt;</code> はリダイレクト先のファイルが存在する場合は元々のファイルの内容を上書きします。上書きではなく追記を行いたい場合は
          <code>&gt;&gt;</code> を使用します。
        </li>
        <li>
          <code>&gt;</code> も <code>&gt;&gt;</code> もリダイレクト先のファイルが存在しない場合はファイルを新規に作成し、そこに出力します。
        </li>
        <li>
          <code>&gt;&gt;</code> も <code>&gt;</code> と同様に記号の左側でファイルディスクリプタの番号を指定できます。
        </li>
      </ul>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong><code>/dev/null</code></strong><br>
        <code>/dev/null</code>
        は特殊なファイルで、読み込んでも何もデータを返さず、書き込んでも結果的にどこにも書き込まれることなくデータが消えていきます。そのため、出力のリダイレクトと組み合わせて、不要なエラー出力を破棄したり、サイズ0のファイルを作成したりするのに使われます。
      </p>
      <div class="code-frame" data-lang="bash">
        <div class="highlight">
          <pre><code>./myscript.sh 2&gt; /dev/null <span class="c"># 不要なエラー出力の破棄</span>
<span class="nb">cat</span> /dev/null <span class="o">&gt;</span> empty.txt  <span class="c"># サイズ0のテキストファイルを作成</span>
</code></pre>
        </div>
      </div>
    </div>
  </div>
  <h2>
    <span id="10-2-標準出力と標準エラー出力を同時にリダイレクトしてみよう" class="fragment"></span><a
      href="#10-2-%E6%A8%99%E6%BA%96%E5%87%BA%E5%8A%9B%E3%81%A8%E6%A8%99%E6%BA%96%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%BA%E5%8A%9B%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(10-2) 標準出力と標準エラー出力を同時にリダイレクトしてみよう
  </h2>
  <p>
    リダイレクトは1行で複数指定することが可能です。標準出力と標準エラー出力を別々のファイルにリダイレクトしたい場合は以下のように指定します。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> /bin /error <span class="o">&gt;</span> bin.txt 2&gt; error.txt
</code></pre>
    </div>
  </div>
  <p>逆に、標準出力と標準エラー出力を同じファイルにリダイレクトしたい場合は以下のように <code>&amp;&gt;</code>
    で指定します。（上書きの場合は <code>&amp;&gt;&gt;</code>）</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> /bin /error &amp;&gt; result.txt
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <details>
        <summary><b><code>&amp;&gt;</code> についての詳細</b></summary>
        <div>
          <p>以下の2つは同じ処理を表しています。</p>
          <div class="code-frame" data-lang="shell-session">
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> /bin /error &amp;&gt; result.txt
<span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> /bin /error <span class="o">&gt;</span> result.txt 2&gt;&amp;1
</code></pre>
            </div>
          </div>
          <p><code>n&gt;&amp;m</code>
            はファイルディスクリプタn番をファイルディスクリプタm番のコピーにするという意味です。上の例では、まず、 <code>&gt; result.txt</code>
            で標準出力の出力先が result.txt に変わり、続いて <code>2&gt;&amp;1</code>
            で標準エラー出力が標準出力のコピーになります。標準出力の出力先はすでに result.txt に置換されているため、標準エラー出力の出力先も result.txt
            になります。その結果、標準出力、標準エラー出力の両方が result.txt にリダイレクトされることになります。</p>
          <p>逆に、 <code>1&gt;&amp;2</code>
            とすると標準出力が標準エラー出力と同じ場所にされるようになります。</p>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo </span>success   <span class="c"># こちらは標準出力に出力される</span>
<span class="nb">echo </span>fail 1&gt;&amp;2 <span class="c"># こちらは標準エラー出力に出力される</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">$</span><span class="w"> </span>./test.sh <span class="o">&gt;</span> result.txt
<span class="go">fail
</span></code></pre>
            </div>
          </div>
          <p><code>n&gt;&amp;m</code> の <code>n</code> は省略すると
            <code>1</code> とみなされるので、 <code>1&gt;&amp;2</code> と <code>&gt;&amp;2</code> は同義です。
          </p>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="10-3-入力のリダイレクト機能を使ってみよう" class="fragment"></span><a
      href="#10-3-%E5%85%A5%E5%8A%9B%E3%81%AE%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(10-3) 入力のリダイレクト機能を使ってみよう
  </h2>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <details>
        <summary><b>通常の標準入力の動作イメージ</b></summary>
        <div>
          <p>まずリダイレクトしない通常の標準入力がどのように動作するのかを <code>cat</code>
            コマンドを例に確認しましょう。<code>cat</code> コマンドを引数なしで実行すると、標準入力からの入力を受け付ける状態になり、対話的な操作が開始されます。試しに a
            と打って Enter を押すと、<code>cat</code> コマンドは標準入力から受け取った a という文字をそのまま標準出力に出力します。</p>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">cat</span>
<span class="gp">=&gt;</span><span class="w"> </span>a
<span class="go">a
</span><span class="gp">=&gt;</span><span class="w"> </span>bb
<span class="go">bb
</span><span class="gp">=&gt;</span><span class="w"> </span>ccc
<span class="go">ccc
</span><span class="gp">=&gt;</span><span class="w"> </span><span class="o">(</span>Ctrl + D<span class="o">)</span> <span class="c"># 入力の終了を表す</span>
</code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <p>標準入力のリダイレクトは <code>&lt;</code> で可能です。<code>&lt;</code> は
    <code>0&lt;</code> の省略形で、入力のリダイレクト先として <code>0</code> の他にもファイルディスクリプタの番号を指定できます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">tr </span>hoge fuga &lt; hoge.txt
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>hoge.txt
<span class="go">hoge hoge
</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">fuga fuga
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="10-4-ヒアドキュメントを使ってみよう" class="fragment"></span><a
      href="#10-4-%E3%83%92%E3%82%A2%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(10-4) ヒアドキュメントを使ってみよう
  </h2>
  <p>
    リダイレクトでは標準入力をファイルに置き換えていましたが、ファイルではなく直接シェルスクリプト内に入力文字列を書きたい場合はヒアドキュメントを使います。ヒアドキュメントの構文は次のようになります。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code>コマンド <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
ヒアドキュメントとして入力される内容
</span><span class="no">EOF
</span></code></pre>
    </div>
  </div>
  <p>後述のコマンド置換との併用により、複数行の文字列をファイルを介さずに変数に代入することも可能です。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var1</span><span class="o">=</span>value
<span class="nv">text</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
    arg1: </span><span class="nv">$1</span><span class="sh">       # 位置パラメータや変数なども展開される
    var1: </span><span class="nv">$var1</span><span class="sh">    # コメントも出力されてしまう
</span><span class="no">EOF
</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$text</span><span class="s2">"</span>       <span class="c"># "" でクォートしないと出力時に改行されない</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh <span class="nb">test</span>
<span class="gp">    arg1: test     #</span><span class="w"> </span>位置パラメータや変数なども展開される
<span class="gp">    var1: value    #</span><span class="w"> </span>コメントも出力されてしまう
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong><code>EOF</code> について</strong></p>
      <ul>
        <li>
          <strong>書き方の注意点</strong>
          <ul>
            <li>2つある <code>EOF</code> の部分は終了文字列と言い、 <code>EOF</code>
              以外でもどんな文字列でも良いのですが、一般的には <code>EOF</code>, <code>EOD</code>, <code>EOS</code>,
              <code>END</code> などが使われます。ただし、ヒアドキュメントの内容の中で出てこない文字列を選ぶ必要がある点には注意してください。
            </li>
            <li>最後の <code>EOF</code> は1つの行に単独で書く必要があります。</li>
            <li>最後の <code>EOF</code> の前後にはスペースやタブなどの空白文字を入れることはできません。
            </li>
          </ul>
        </li>
        <li>
          <strong><code>&lt;&lt; 'EOF'</code></strong>
          <ul>
            <li>
              ヒアドキュメントの中では後述する展開が行われます。ヒアドキュメント全体で展開をしないようにしたい場合は、　<code>&lt;&lt;</code> の右に書く終了文字列を
              <code>''</code> でクォートします。
            </li>
          </ul>
        </li>
        <li>
          <strong><code>&lt;&lt;-EOF</code></strong>
          <ul>
            <li>
              <code>&lt;&lt;</code> の代わりに <code>&lt;&lt;-</code>
              と書くとヒアドキュメント内の行頭タブが無視されます。ヒアドキュメントをわかりやすいように書くためのインデントを無視できますが、スペースによるインデントは無視されないので注意が必要です。
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>ヒアストリング <code>&lt;&lt;&lt;</code></strong><br>
        ヒアストリングはヒアドキュメントを1行にした書き方で、終了文字列は不要です。 <code>&lt;&lt;&lt;</code>
        の右に書いた文字列では、ヒアドキュメントと同様。展開が行われます。</p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var1</span><span class="o">=</span>value
<span class="nv">text</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="o">&lt;&lt;&lt;</span> <span class="s2">"var1: </span><span class="nv">$var1</span><span class="s2">"</span><span class="si">)</span> <span class="c"># &lt;&lt;&lt; の右は1つの文字列でないといけない</span>
<span class="nb">echo</span> <span class="nv">$text</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">var1: value
</span></code></pre>
        </div>
      </div>
    </div>
  </div>
  <h2>
    <span id="10-5-パイプラインを使ってみよう" class="fragment"></span><a
      href="#10-5-%E3%83%91%E3%82%A4%E3%83%97%E3%83%A9%E3%82%A4%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(10-5) パイプラインを使ってみよう
  </h2>
  <p>
    コマンドの出力はリダイレクトでファイルに出力する代わりに、別のコマンドの入力にすることも可能です。このような機能をパイプラインと呼び、 <code>|</code>
    という記号で書くことができます。パイプラインは前のコマンドの標準出力を後続のコマンドの標準入力に渡すものであり、後続のコマンドの引数として前のコマンドの出力をつかうことはできません。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">$ </span><span class="nb">ls </span>src | <span class="nb">grep</span> <span class="s1">'.sh'</span> | <span class="nb">head</span> <span class="nt">-n</span> 10 <span class="c"># src ディレクトリ内の .sh ファイルを上から 10個表示</span>
</code></pre>
    </div>
  </div>
  <p>標準エラー出力も合わせて次のコマンドに渡す場合は <code>|&amp;</code> または
    <code>2&gt;&amp;1</code> を使います。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">$ </span><span class="nb">ls </span>src bin |&amp; <span class="nb">grep</span> <span class="s1">'.sh'</span> | <span class="nb">head</span> <span class="nt">-n</span> 10
<span class="nv">$ </span><span class="nb">ls </span>src bin 2&gt;&amp;1 | <span class="nb">grep</span> <span class="s1">'.sh'</span> | <span class="nb">head</span> <span class="nt">-n</span> 10
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>プロセス置換</strong><br>
        コマンドの実行結果を別のコマンドの入力として使用するための機能としてプロセス置換があります。パイプラインでは1つのコマンドの結果しか渡すことができませんが、プロセス置換を使うことによって2つ以上の引数を指定する
        <code>diff</code> などのコマンドに、別のコマンドの実行結果を渡すことができます。
      </p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>

diff &lt;<span class="o">(</span><span class="nb">ls </span>dir-a<span class="o">)</span> &lt;<span class="o">(</span><span class="nb">ls </span>dir-b<span class="o">)</span>
</code></pre>
        </div>
      </div>
      <p>これを知らないと同じことをするために中間ファイルとして一時ファイルを作成（+削除）する手間が発生してしまいます。</p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">ls </span>dir-a <span class="o">&gt;</span> tmp-a.txt
<span class="nb">ls </span>dir-b <span class="o">&gt;</span> tmp-b.txt
diff tmp-a.txt tmp-b.txt
<span class="nb">rm </span>tmp-a.txt tmp-b.txt
</code></pre>
        </div>
      </div>
    </div>
  </div>
  <h2>
    <span id="10-6-グループコマンドを使ってみよう" class="fragment"></span><a
      href="#10-6-%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(10-6) グループコマンドを使ってみよう
  </h2>
  <p><code>{}</code>
    で複数のコマンドを囲むことで、複数のコマンドの出力をまとめて1つのファイルにリダイレクトすることができます。以下は全て同義です。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="c"># 通常の方法</span>
<span class="nb">echo </span>first message <span class="o">&gt;</span> output.txt
<span class="nb">echo </span>second message <span class="o">&gt;&gt;</span> output.txt
<span class="nb">echo </span>third message <span class="o">&gt;&gt;</span> output.txt

<span class="c"># グループコマンドの使用</span>
<span class="o">{</span>
  <span class="nb">echo </span>first message
  <span class="nb">echo </span>second message
  <span class="nb">echo </span>third message
<span class="o">}</span> <span class="o">&gt;</span> output.txt

<span class="c"># グループコマンドを1行で書く場合はコマンド同士を ; で区切る。最後のコマンドにも必要。</span>
<span class="o">{</span> <span class="nb">echo </span>first message<span class="p">;</span> <span class="nb">echo </span>second message<span class="p">;</span> <span class="nb">echo </span>third message<span class="p">;</span> <span class="o">}</span> <span class="o">&gt;</span> output.txt
</code></pre>
    </div>
  </div>
  <p><code>{}</code> の代わりに <code>()</code>
    で囲むことでも同様のことが可能です。ただし、<code>()</code> で囲んだ時は中身のコマンドはサブシェルで実行されます。現在のシェルから子プロセスとして別のシェルが起動され、その中で
    <code>()</code> 内のコマンドが実行されます。これを利用することで、 <code>()</code>
    内でカレントディレクトリを変更しても親のプロセスに影響を与えずに処理を続けたりすることができます。また、サブシェル外で定義された変数はサブシェル内でも使えますが、サブシェル内でその変数の値を変更しても、サブシェル外に影響は与えません。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">cd</span> /bin
<span class="nb">pwd
</span><span class="nv">var1</span><span class="o">=</span>value1
<span class="nb">echo</span> <span class="nv">$var1</span>

<span class="o">(</span>
  <span class="nb">cd</span> /home/myname
  <span class="nb">pwd
  echo</span> <span class="nv">$var1</span>
  <span class="nv">var1</span><span class="o">=</span>value2
  <span class="nb">echo</span> <span class="nv">$var1</span>
<span class="o">)</span>

<span class="nb">pwd
echo</span> <span class="nv">$var1</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">/bin
value1
/home/myname
value1
value2
/bin
value1
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="11-オプションを使ってデバッグしやすくしよう" class="fragment"></span><a
      href="#11-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%87%E3%83%90%E3%83%83%E3%82%B0%E3%81%97%E3%82%84%E3%81%99%E3%81%8F%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>11. オプションを使ってデバッグしやすくしよう
  </h1>
  <h2>
    <span id="11-1--e-オプションを使ってみよう" class="fragment"></span><a
      href="#11-1--e-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(11-1) <code>-e</code> オプションを使ってみよう
  </h2>
  <p>
    普通シェルスクリプトを実行した時は、途中のコマンドでエラーが起きても止まらず、最後まで処理を続けてしまいます。<code>-e</code>
    オプションを使うことで、シェルスクリプト内で何らかのエラーが発生した時点で、シェルスクリプトを終了してくれます。使い方は簡単で、シェルスクリプト内で <code>set -e</code>
    と書くと、その場所からオプションが有効になります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-e</span>

<span class="nb">ls</span> /error         <span class="c"># ここでエラーが起きて、その時点で止まる</span>
<span class="nb">mkdir</span> /error/dir1 <span class="c"># この処理は実行されない</span>
</code></pre>
    </div>
  </div>
  <h2>
    <span id="11-2--u-オプションを使ってみよう" class="fragment"></span><a
      href="#11-2--u-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(11-2) <code>-u</code> オプションを使ってみよう
  </h2>
  <p><code>-u</code>
    オプションを使うことで未定義の変数を参照しようとした際にシェルスクリプトをエラー終了にしてくれます。使い方は <code>-e</code> オプションと同じで、シェルスクリプト内で
    <code>set -u</code> と書くと、その場所からオプションが有効になります。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-u</span>

<span class="c"># ここら辺で work_dir を定義していたと勘違い</span>

<span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$work_dir</span>/ <span class="c"># -u オプションがなければここで / 以下を全部消してしまうところだった</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh 
<span class="go">./test.sh: line 6: work_dir: unbound variable
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="11-3--x-オプションを使ってみよう" class="fragment"></span><a
      href="#11-3--x-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(11-3) <code>-x</code> オプションを使ってみよう
  </h2>
  <p><code>-x</code>
    オプションをつけることで、実行したコマンドをすべて標準エラー出力に出力してくれます。標準エラー出力なので、標準出力とリダイレクト先を分けておけば、シェルスクリプトの出力はターミナルに表示し、<code>-x</code>
    による実行コマンドのログはファイルに出力することもできます。また、<code>-x</code> による出力は展開後の文字列で行われます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-x</span>

<span class="nv">var1</span><span class="o">=</span>value
<span class="nb">echo</span> <span class="nv">$var1</span>

<span class="nv">var1</span><span class="o">=</span>value2
<span class="nb">echo</span> <span class="nv">$var1</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh 2&gt; log.txt <span class="c"># -x の出力先は標準エラー出力なので、リダイレクトしておく</span>
<span class="go">value
value2

</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>log.txt
<span class="go">+ var1=value
+ echo value
+ var1=value2
+ echo value2
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="11-4--c-オプションを使ってみよう" class="fragment"></span><a
      href="#11-4--c-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(11-4) <code>-C</code> オプションを使ってみよう
  </h2>
  <p><code>&gt;</code>
    で出力のリダイレクト先に既存のファイルを指定すると、元々の中身を上書きしてしまいますが、<code>-C</code>
    オプションを使うと上書きしようとした際にエラーにしてくれます。<code>-C</code> オプションをつけていても <code>&gt;&gt;</code>
    による追記は可能です。また、<code>-C</code> オプションを有効にしている際に、それでも上書きをしたい場合は、リダイレクトの記号を <code>&gt;|</code>
    とすることで上書きが可能になります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-C</span>

<span class="nb">touch </span>test1.txt 
<span class="nb">echo</span> <span class="s2">"aaa"</span> <span class="o">&gt;</span>| test1.txt <span class="c"># 上書きだけど &gt;| なので OK</span>
<span class="nb">echo</span> <span class="s2">"bbb"</span> <span class="o">&gt;&gt;</span> test1.txt <span class="c"># 追記なので OK</span>

<span class="nb">touch </span>test2.txt
<span class="nb">echo</span> <span class="s2">"ccc"</span> <span class="o">&gt;</span> test2.txt  <span class="c"># 上書きのため、ここでエラー</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">./test.sh: line 9: test2.txt: cannot overwrite existing file
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>test1.txt
<span class="go">aaa
bbb
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="11-5--o-pipefail-オプションを使ってみよう" class="fragment"></span><a
      href="#11-5--o-pipefail-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(11-5) <code>-o pipefail</code> オプションを使ってみよう
  </h2>
  <p><code>-e</code>
    オプションでコマンドでのエラー発生時にシェルスクリプトが終了すると解説したのですが、パイプラインの途中でエラーが起きた時はキャッチしてくれません。これはパイプライン全体の終了ステータスが通常パイプラインの末尾のコマンドの終了ステータスになっているため、末尾のコマンドで成功すると途中のコマンドで失敗していてもエラー判定にならないからです。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">false</span> | <span class="nb">true
echo</span> <span class="nv">$?</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">0
</span></code></pre>
    </div>
  </div>
  <p><code>-o pipefail</code>
    オプションをつけるとパイプラインの途中でエラーが起きた時に、パイラプイン全体の終了ステータスをエラーの起きたコマンドの終了ステータスと同じにしてくれます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-o</span> pipefail

<span class="nb">false</span> | <span class="nb">true
echo</span> <span class="nv">$?</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">1
</span></code></pre>
    </div>
  </div>
  <p>これと <code>-e</code>
    を組み合わせることで、パイプラインの途中でエラーが起きた時点でシェルスクリプトを終了できるようになります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-e</span>
<span class="nb">set</span> <span class="nt">-o</span> pipefail

<span class="nb">false</span> | <span class="nb">true</span> <span class="c"># ここでエラーが出てシェルスクリプトが終了する</span>
<span class="nb">echo</span> <span class="nv">$?</span>      <span class="c"># よって、これは出力されない</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
</code></pre>
    </div>
  </div>
  <h2>
    <span id="11-6-複数のオプションを同時に使ってみよう" class="fragment"></span><a
      href="#11-6-%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E5%90%8C%E6%99%82%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(11-6) 複数のオプションを同時に使ってみよう
  </h2>
  <p>複数のオプションを有効にする方法は以下の通りです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="c"># 1個ずつ set していく</span>
<span class="nb">set</span> <span class="nt">-e</span>
<span class="nb">set</span> <span class="nt">-u</span>
<span class="nb">set</span> <span class="nt">-x</span>
<span class="nb">set</span> <span class="nt">-o</span> pipefail

<span class="c"># 1行で全て set する</span>
<span class="nb">set</span> <span class="nt">-e</span> <span class="nt">-u</span> <span class="nt">-x</span> <span class="nt">-o</span> pipefail

<span class="c"># オプション同士を繋げて set する</span>
<span class="nb">set</span> <span class="nt">-euxo</span> pipefail
</code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>shebang でオプションを指定する方法（非推奨）</strong><br>
        ここまでオプションは <code>set</code> で有効化していましたが、実は以下のように shebang でも有効化できます。</p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash -u</span>

<span class="nb">echo</span> <span class="nv">$undefined</span>
<span class="nv">defined</span><span class="o">=</span><span class="s1">'defined'</span>
<span class="nb">echo</span> <span class="nv">$defined</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">./test.sh: line 3: undefined: unbound variable
</span></code></pre>
        </div>
      </div>
      <p>ただし、この指定方法のときに <code>bash test.sh</code> のような起動方法をすると
        shebang が無視されてオプションが効きません。オプションは <code>set</code> で指定することをオススメします。</p>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>bash test.sh
<span class="go">
defined
</span></code></pre>
        </div>
      </div>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>一時的にオプションの効果を無効化する方法</strong><br>
        オプションの前の文字を <code>-</code> ではなく <code>+</code> にすると、そのオプションを無効化することができます。</p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-x</span>
<span class="nb">echo</span> <span class="s1">'hoge'</span>
<span class="nb">set</span> +x
<span class="nb">echo</span> <span class="s1">'fuga'</span>
<span class="nb">set</span> <span class="nt">-x</span>
<span class="nb">echo</span> <span class="s1">'hogefuga'</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">+ echo hoge
hoge
+ set +x
fuga
+ echo hogefuga
hogefuga
</span></code></pre>
        </div>
      </div>
    </div>
  </div>
  <h1>
    <span id="12-便利なパラメータ展開を使ってみよう" class="fragment"></span><a
      href="#12-%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%B1%95%E9%96%8B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>12. 便利なパラメータ展開を使ってみよう
  </h1>
  <h2>
    <span id="12-1-展開とは" class="fragment"></span><a href="#12-1-%E5%B1%95%E9%96%8B%E3%81%A8%E3%81%AF"><i
        class="fa fa-link"></i></a>(12-1) 展開とは
  </h2>
  <p>
    シェルは特殊文字を他の文字列に置換する「展開」という機能を持っています。この展開を使用することで、面倒な文字列操作を簡略化したり、コマンドや計算実行結果を変数で保持したりすることができます。bash
    では以下の展開機能を持っています。</p>
  <ul>
    <li>パラメータ展開</li>
    <li>パス名展開</li>
    <li>ブレース展開</li>
    <li>チルダ展開</li>
    <li>コマンド置換</li>
    <li>算術式展開・評価</li>
    <li>プロセス置換</li>
  </ul>
  <p>この章ではパラメータ展開について解説します。</p>
  <h2>
    <span id="12-2-パラメータ展開とは" class="fragment"></span><a
      href="#12-2-%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%B1%95%E9%96%8B%E3%81%A8%E3%81%AF"><i
        class="fa fa-link"></i></a>(12-2) パラメータ展開とは
  </h2>
  <p>変数の参照</a>で変数名の前に
    <code>$</code> をつけて
    <code>$変数名</code> とすると、変数の値を参照できると解説しましたが、これも展開の一種です。<code>$変数名</code>
    の部分が変数の値に置換されているのです。このような展開を<strong>パラメータ展開</strong>と呼びます。<br>
    <code>${変数名}</code> のように <code>{}</code> を付けてもパラメータ展開が働きますが、この <code>{}</code> の中で <code>:=</code>
    などの特殊な記号を用いることで、変数の値を操作することもできます。このようなパラメータ展開を利用することで、複雑な文字列処理を短く簡単に書けたり、条件分岐を省略したりすることができます。
  </p>
  <h2>
    <span id="12-3-parameter-default-デフォルト値への置換" class="fragment"></span><a
      href="#12-3-parameter-default-%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%B8%E3%81%AE%E7%BD%AE%E6%8F%9B"><i
        class="fa fa-link"></i></a>(12-3) <code>${parameter:-default}</code>: デフォルト値への置換
  </h2>
  <p>参照した変数に値が入っていない（未定義またはた空文字）場合、 <code>:-</code>
    の後ろの文字列がデフォルト値として返されます。</p>
  <details>
    <summary>動作例</summary>
    <div>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>first
<span class="nv">var</span><span class="o">=</span><span class="s2">"value"</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:-default}'</span>: <span class="k">${</span><span class="nv">var</span><span class="k">:-</span><span class="nv">default</span><span class="k">}</span> <span class="c"># 値が入っているときは置換されない</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo unset
unset </span>var
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'$var:-default'</span>: <span class="nv">$var</span>:-default     <span class="c"># {} をつけないと適用されない</span>
<span class="nb">echo</span> <span class="s1">'${var:-default}'</span>: <span class="k">${</span><span class="nv">var</span><span class="k">:-</span><span class="nv">default</span><span class="k">}</span> <span class="c"># 値が入っていないので置換される</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 適用後も元の値は変わらない</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>empty
<span class="nv">var</span><span class="o">=</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:-default}'</span>: <span class="k">${</span><span class="nv">var</span><span class="k">:-</span><span class="nv">default</span><span class="k">}</span> <span class="c"># 空文字でも置換される</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 適用後も元の値は変わらない</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">----------------------------------
first
</span><span class="gp">$</span>var: value
<span class="gp">$</span><span class="o">{</span>var:-default<span class="o">}</span>: value
<span class="go">----------------------------------
unset
</span><span class="gp">$</span>var:
<span class="gp">$</span>var:-default: :-default
<span class="gp">$</span><span class="o">{</span>var:-default<span class="o">}</span>: default
<span class="gp">$</span>var:
<span class="go">----------------------------------
empty
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var:-default<span class="o">}</span>: default
<span class="gp">$</span>var:
</code></pre>
        </div>
      </div>
    </div>
  </details>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>こんなときに便利！</strong><br>
        シェルスクリプトの引数が指定されていない時のデフォルト値の指定</p>
      <details>
        <summary>例</summary>
        <div>
          <div class="code-frame" data-lang="bash">
            <div class="code-lang"><span class="bold">test.sh</span></div>
            <div class="highlight">
              <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">file</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">default</span><span class="p">.csv</span><span class="k">}</span> <span class="c"># 位置パラメータに対しても使用可能</span>
<span class="nb">echo</span> <span class="nv">$file</span>
</code></pre>
            </div>
          </div>
          <div class="code-frame" data-lang="shell-session">
            <div class="code-lang"><span class="bold">terminal</span></div>
            <div class="highlight">
              <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">default.csv
</span></code></pre>
            </div>
          </div>
        </div>
      </details>
    </div>
  </div>
  <h2>
    <span id="12-4-parameter-default-未定義時のみデフォルト値への置換" class="fragment"></span><a
      href="#12-4-parameter-default-%E6%9C%AA%E5%AE%9A%E7%BE%A9%E6%99%82%E3%81%AE%E3%81%BF%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%B8%E3%81%AE%E7%BD%AE%E6%8F%9B"><i
        class="fa fa-link"></i></a>(12-4) <code>${parameter-default}</code>: 未定義時のみデフォルト値への置換
  </h2>
  <p><code>:</code> を抜いて <code>-</code>
    だけにすると、参照した変数が<strong>未定義の場合のみ</strong>、 <code>-</code> の後ろの文字列がデフォルト値として返されます。</p>
  <details>
    <summary>動作例</summary>
    <div>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>first
<span class="nv">var</span><span class="o">=</span><span class="s2">"value"</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var-default}'</span>: <span class="k">${</span><span class="nv">var</span><span class="p">-default</span><span class="k">}</span>   <span class="c"># 値が入っているときは置換されない</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo unset
unset </span>var
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var-default}'</span>: <span class="k">${</span><span class="nv">var</span><span class="p">-default</span><span class="k">}</span>   <span class="c"># 値が入っていないので置換される</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 適用後も元の値は変わらない</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>empty
<span class="nv">var</span><span class="o">=</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var-default}'</span>: <span class="k">${</span><span class="nv">var</span><span class="p">-default</span><span class="k">}</span>   <span class="c"># 空文字では置換されない</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 空文字のまま</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">----------------------------------
first
</span><span class="gp">$</span>var: value
<span class="gp">$</span><span class="o">{</span>var-default<span class="o">}</span>: value
<span class="go">----------------------------------
unset
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var-default<span class="o">}</span>: default
<span class="gp">$</span>var:
<span class="go">----------------------------------
empty
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var-default<span class="o">}</span>: 
<span class="gp">$</span>var:
</code></pre>
        </div>
      </div>
    </div>
  </details>
  <h2>
    <span id="12-5-parameterdefault-デフォルト値の代入" class="fragment"></span><a
      href="#12-5-parameterdefault-%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%AE%E4%BB%A3%E5%85%A5"><i
        class="fa fa-link"></i></a>(12-5) <code>${parameter:=default}</code>: デフォルト値の代入
  </h2>
  <p>参照した変数に値が入っていない（未定義またはた空文字）場合、 <code>:=</code>
    の後ろの文字列がデフォルト値として返され、さらに、<strong>変数にデフォルト値が代入されます</strong>。</p>
  <details>
    <summary>動作例</summary>
    <div>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>first
<span class="nv">var</span><span class="o">=</span><span class="s2">"value"</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:=default}'</span>: <span class="k">${</span><span class="nv">var</span>:<span class="p">=default</span><span class="k">}</span> <span class="c"># 値が入っているときは代入されない</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo unset
unset </span>var
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:=default}'</span>: <span class="k">${</span><span class="nv">var</span>:<span class="p">=default</span><span class="k">}</span> <span class="c"># 値が入っていないので代入される</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 適用後は元の値が変わっている</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>empty
<span class="nv">var</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:=default}'</span>: <span class="k">${</span><span class="nv">var</span>:<span class="p">=default</span><span class="k">}</span> <span class="c"># 空文字でも代入される</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 適用後は元の値が変わっている</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">----------------------------------
first
</span><span class="gp">$</span>var: value
<span class="gp">$</span><span class="o">{</span>var:<span class="o">=</span>default<span class="o">}</span>: value
<span class="go">----------------------------------
unset
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var:<span class="o">=</span>default<span class="o">}</span>: default
<span class="gp">$</span>var:　default
<span class="go">----------------------------------
empty
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var:<span class="o">=</span>default<span class="o">}</span>: default
<span class="gp">$</span>var: default
</code></pre>
        </div>
      </div>
    </div>
  </details>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>こんなときに便利！</strong></p>
      <p>値が入っていない変数にのみ初期値を与えたい場合に以下のような条件分岐を発生させずに済みます</p>
      <div class="code-frame" data-lang="bash">
        <div class="highlight">
          <pre><code><span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="k">${</span><span class="nv">parameter</span><span class="k">}</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nv">parameter</span><span class="o">=</span><span class="s2">"default"</span>
<span class="k">fi</span>
<span class="c"># =&gt; ${parameter:=default} で代用可能</span>
</code></pre>
        </div>
      </div>
    </div>
  </div>
  <h2>
    <span id="12-6-parameterdefault-未定義時のみデフォルト値への置換" class="fragment"></span><a
      href="#12-6-parameterdefault-%E6%9C%AA%E5%AE%9A%E7%BE%A9%E6%99%82%E3%81%AE%E3%81%BF%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%B8%E3%81%AE%E7%BD%AE%E6%8F%9B"><i
        class="fa fa-link"></i></a>(12-6) <code>${parameter=default}</code>: 未定義時のみデフォルト値への置換
  </h2>
  <p><code>:</code> を抜いて <code>=</code>
    だけにすると、参照した変数が<strong>未定義の場合のみ</strong>、 <code>=</code>
    の後ろの文字列がデフォルト値として返され、さらに、<strong>変数にデフォルト値が代入されます</strong>。(動作例は省略）</p>
  <h2>
    <span id="12-7-parameterdefault-デフォルト値の使用" class="fragment"></span><a
      href="#12-7-parameterdefault-%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%AE%E4%BD%BF%E7%94%A8"><i
        class="fa fa-link"></i></a>(12-7) <code>${parameter:+default}</code>: デフォルト値の使用
  </h2>
  <p><code>:-</code>, <code>:=</code> があれば <code>:+</code>
    もあります。ただ、<code>:-</code>, <code>:=</code> とは逆に、参照した変数に<strong>値が入っている（未定義またはた空文字でない）場合</strong>に、
    <code>:+</code> の後ろの文字列がデフォルト値として返され、さらに、<strong>変数にデフォルト値が代入されます</strong>。正直使い道はよくわかりません。
  </p>
  <details>
    <summary>動作例</summary>
    <div>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>first
<span class="nv">var</span><span class="o">=</span><span class="s2">"value"</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:+default}'</span>: <span class="k">${</span><span class="nv">var</span>:+default<span class="k">}</span> <span class="c"># 値が入っているので代入される</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo unset
unset </span>var
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:+default}'</span>: <span class="k">${</span><span class="nv">var</span>:+default<span class="k">}</span> <span class="c"># 値が入っていないので代入されない</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 値が入っていないまま</span>

<span class="nb">echo</span> <span class="nt">----------------------------------</span>
<span class="nb">echo </span>empty
<span class="nv">var</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>
<span class="nb">echo</span> <span class="s1">'${var:+default}'</span>: <span class="k">${</span><span class="nv">var</span>:+default<span class="k">}</span> <span class="c"># 値が入っていないので代入されない</span>
<span class="nb">echo</span> <span class="s1">'$var'</span>: <span class="nv">$var</span>                       <span class="c"># 値が入っていないまま</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">----------------------------------
first
</span><span class="gp">$</span>var: value
<span class="gp">$</span><span class="o">{</span>var:+default<span class="o">}</span>: default
<span class="go">----------------------------------
unset
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var:+default<span class="o">}</span>: 
<span class="gp">$</span>var:　
<span class="go">----------------------------------
empty
</span><span class="gp">$</span>var:
<span class="gp">$</span><span class="o">{</span>var:+default<span class="o">}</span>: 
<span class="gp">$</span>var: 
</code></pre>
        </div>
      </div>
    </div>
  </details>
  <h2>
    <span id="12-8-parameterdefault-定義時にデフォルト値の使用" class="fragment"></span><a
      href="#12-8-parameterdefault-%E5%AE%9A%E7%BE%A9%E6%99%82%E3%81%AB%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%AE%E4%BD%BF%E7%94%A8"><i
        class="fa fa-link"></i></a>(12-8) <code>${parameter+default}</code>: 定義時にデフォルト値の使用
  </h2>
  <p>参照した変数が未定義でない場合に、 <code>+</code>
    の後ろの文字列がデフォルト値として返され、さらに、変数にデフォルト値が代入されます。こちらは値が空文字の場合でもデフォルト値が代入されます。(動作例は省略）</p>
  <h2>
    <span id="12-9-parametermessage-値の検査とエラー" class="fragment"></span><a
      href="#12-9-parametermessage-%E5%80%A4%E3%81%AE%E6%A4%9C%E6%9F%BB%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC"><i
        class="fa fa-link"></i></a>(12-9) <code>${parameter:?[message]}</code>: 値の検査とエラー
  </h2>
  <p>参照した変数が未定義または空文字の場合に、message を表示し、
    非対話実行されているシェルをエラー終了にします。message は省略することもでき、省略するとデフォルトのエラーメッセージが表示されます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"value"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span>:?value<span class="p"> is undefined</span><span class="k">}</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span>:?value<span class="p"> is undefined</span><span class="k">}</span> <span class="c"># 空文字なのでここでエラー終了する</span>

<span class="nb">unset </span>var
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span>:?value<span class="p"> is undefined</span><span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value
./test.sh: line 7: var: value is undefined
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-10-parametermessage-値の検査とエラー" class="fragment"></span><a
      href="#12-10-parametermessage-%E5%80%A4%E3%81%AE%E6%A4%9C%E6%9F%BB%E3%81%A8%E3%82%A8%E3%83%A9%E3%83%BC"><i
        class="fa fa-link"></i></a>(12-10) <code>${parameter?[message]}</code>: 値の検査とエラー
  </h2>
  <p><code>:</code> を抜いて <code>?</code>
    だけにすると、参照した変数が<strong>未定義の場合のみ</strong>エラー終了にします。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var2</span><span class="o">=</span><span class="s2">"value2"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var2</span><span class="p">?</span><span class="k">}</span>

<span class="nv">var2</span><span class="o">=</span><span class="s2">""</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var2</span><span class="p">?</span><span class="k">}</span> <span class="c"># 空文字なのでここではエラーにならない</span>

<span class="nb">unset </span>var2
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var2</span><span class="p">?</span><span class="k">}</span> <span class="c"># 未定義なのでここでエラー終了する。messageが未指定の場合はデフォルトのメッセージが出力される。</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">value2

./test.sh: line 10: var2: parameter null or not set
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-11-parameter-文字列長の取得" class="fragment"></span><a
      href="#12-11-parameter-%E6%96%87%E5%AD%97%E5%88%97%E9%95%B7%E3%81%AE%E5%8F%96%E5%BE%97"><i
        class="fa fa-link"></i></a>(12-11) <code>${#parameter}</code>: 文字列長の取得
  </h2>
  <p>パラメータ展開だけで文字列長を取得できてしまいます。日本語でもOKです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"hoge"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="k">}</span>の長さは<span class="k">${#</span><span class="nv">var</span><span class="k">}</span>です

<span class="nv">var</span><span class="o">=</span><span class="s2">"墾田永年私財法"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="k">}</span>の長さは<span class="k">${#</span><span class="nv">var</span><span class="k">}</span>です
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">hogeの長さは4です
墾田永年私財法の長さは7です
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-12-parameteroffset-parameteroffsetlength-部分抽出" class="fragment"></span><a
      href="#12-12-parameteroffset-parameteroffsetlength-%E9%83%A8%E5%88%86%E6%8A%BD%E5%87%BA"><i
        class="fa fa-link"></i></a>(12-12) <code>${parameter:offset}</code>,
    <code>${parameter:offset:length}</code>: 部分抽出
  </h2>
  <p><code>${parameter:offset}</code> では offset
    で指定した位置以降の文字列を抽出します。さらに <code>:length</code> もつけることで、 offset で指定した位置から length 文字分までを抽出してくれます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"墾田永年私財法"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span>:4<span class="k">}</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span>:0:2<span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">私財法
墾田
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-13-parameterword-前方一致除去最短一致" class="fragment"></span><a
      href="#12-13-parameterword-%E5%89%8D%E6%96%B9%E4%B8%80%E8%87%B4%E9%99%A4%E5%8E%BB%E6%9C%80%E7%9F%AD%E4%B8%80%E8%87%B4"><i
        class="fa fa-link"></i></a>(12-13) <code>${parameter#word}</code>: 前方一致除去(最短一致)
  </h2>
  <p>word で指定した文字列に最短で一致する特定の部分までを除去して抽出してくれます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"kon-den-ei-nen-shi-zai-hou"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">#kon-</span><span class="k">}</span> 
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">#kan-</span><span class="k">}</span> <span class="c"># 前方一致しないので何も消えない</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">#*-</span><span class="k">}</span> <span class="c"># *(ワイルドカード)も使用可能</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">#*den-</span><span class="k">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">den-ei-nen-shi-zai-hou
kon-den-ei-nen-shi-zai-hou
den-ei-nen-shi-zai-hou
ei-nen-shi-zai-hou
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-14-parameterword-前方一致除去最長一致" class="fragment"></span><a
      href="#12-14-parameterword-%E5%89%8D%E6%96%B9%E4%B8%80%E8%87%B4%E9%99%A4%E5%8E%BB%E6%9C%80%E9%95%B7%E4%B8%80%E8%87%B4"><i
        class="fa fa-link"></i></a>(12-14) <code>${parameter##word}</code>: 前方一致除去(最長一致)
  </h2>
  <p><code>#</code> を2つにすると最長一致になります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"kon-den-ei-nen-shi-zai-hou"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">##kon-</span><span class="k">}</span> 
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">##*-</span><span class="k">}</span> <span class="c"># 最短一致と結果が異なる</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">den-ei-nen-shi-zai-hou
hou
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <p><strong>こんなときに便利！</strong><br>
        拡張子に使えます。</p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">file</span><span class="o">=</span><span class="s2">"kon.den/ei.nen/shi-zai-hou.csv"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">file</span><span class="p">##*.</span><span class="k">}</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">csv
</span></code></pre>
        </div>
      </div>
    </div>
  </div>
  <h2>
    <span id="12-15-parameterword-後方一致除去最短一致" class="fragment"></span><a
      href="#12-15-parameterword-%E5%BE%8C%E6%96%B9%E4%B8%80%E8%87%B4%E9%99%A4%E5%8E%BB%E6%9C%80%E7%9F%AD%E4%B8%80%E8%87%B4"><i
        class="fa fa-link"></i></a>(12-15) <code>${parameter%word}</code>: 後方一致除去(最短一致)
  </h2>
  <p><code>#</code> を <code>%</code> に変えると後方一致になります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"kon-den-ei-nen-shi-zai-hou"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">%-hou</span><span class="k">}</span> 
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">%-hau</span><span class="k">}</span> <span class="c"># 後方一致しないので何も消えない</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">%-*</span><span class="k">}</span> <span class="c"># *(ワイルドカード)も使用可能</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">%-zai*</span><span class="k">}</span> 
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">kon-den-ei-nen-shi-zai
kon-den-ei-nen-shi-zai-hou
kon-den-ei-nen-shi-zai
kon-den-ei-nen-shi
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-16parameterword-後方一致除去最長一致" class="fragment"></span><a
      href="#12-16parameterword-%E5%BE%8C%E6%96%B9%E4%B8%80%E8%87%B4%E9%99%A4%E5%8E%BB%E6%9C%80%E9%95%B7%E4%B8%80%E8%87%B4"><i
        class="fa fa-link"></i></a>(12-16)<code>${parameter%%word}</code>: 後方一致除去(最長一致)
  </h2>
  <p><code>%</code> を2つにすると最長一致になります。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"kon-den-ei-nen-shi-zai-hou"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">%%-hou</span><span class="k">}</span> 
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">%%-*</span><span class="k">}</span> <span class="c"># 最短一致と結果が異なる</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">kon-den-ei-nen-shi-zai
kon
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="12-17-parameterword1word2-parameterword1word2-文字列置換" class="fragment"></span><a
      href="#12-17-parameterword1word2-parameterword1word2-%E6%96%87%E5%AD%97%E5%88%97%E7%BD%AE%E6%8F%9B"><i
        class="fa fa-link"></i></a>(12-17) <code>${parameter/word1/word2}</code>,
    <code>${parameter//word1/word2}</code>: 文字列置換
  </h2>
  <p><code>sed</code>
    等を使わずにパラメータ展開だけで文字列の置換もできます。<code>${parameter/word1/word2}</code>
    は最初に一致したもののみを置換し、<code>${parameter//word1/word2}</code> は一致したもの全てを置換します。<code>#</code>,
    <code>%</code> で置換パターンの制限もできます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="s2">"hogehoge"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">/hoge/fuga</span><span class="k">}</span> <span class="c"># 最初だけ置換</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">/geho/fuga</span><span class="k">}</span> <span class="c"># 一致した部分を置換</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">/#hoge/fuga</span><span class="k">}</span> <span class="c"># 前方一致した部分を置換</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">/#geho/fuga</span><span class="k">}</span> <span class="c"># 前方一致しないから変化しない</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">/%hoge/fuga</span><span class="k">}</span> <span class="c"># 後方一致した部分を置換</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">var</span><span class="p">//hoge/fuga</span><span class="k">}</span> <span class="c"># 全て置換</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">fugahoge
hofugage
fugahoge
hogehoge
hogefuga
fugafuga
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="13-ブレース展開を使ってみよう" class="fragment"></span><a
      href="#13-%E3%83%96%E3%83%AC%E3%83%BC%E3%82%B9%E5%B1%95%E9%96%8B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>13. ブレース展開を使ってみよう
  </h1>
  <h2>
    <span id="13-1-str1str2str3-を使ったブレース展開" class="fragment"></span><a
      href="#13-1-str1str2str3-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%96%E3%83%AC%E3%83%BC%E3%82%B9%E5%B1%95%E9%96%8B"><i
        class="fa fa-link"></i></a>(13-1) <code>{str1,str2,str3,・・・}</code> を使ったブレース展開
  </h2>
  <p><code>{}</code> の中にカンマ区切りで文字列を並べると、それぞれの要素が前後の文字列と結合されて展開されます。
  </p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo </span>hoge-<span class="o">{</span>aaa,bbb,ccc<span class="o">}</span><span class="nt">-fuga</span>
<span class="go">hoge-aaa-fuga hoge-bbb-fuga hoge-ccc-fuga
</span></code></pre>
    </div>
  </div>
  <p>これを使うことで、複数のファイルを同時に <code>touch</code> で作成したり、 <code>cp</code>
    で同じディレクトリに別名でファイルをコピーするのが簡単になります。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls test</span>/
<span class="go">hoge
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cp test</span>/<span class="o">{</span>hoge,fuga<span class="o">}</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">ls test</span>/
<span class="go">fuga hoge
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cp test</span>/hoge<span class="o">{</span>,.txt<span class="o">}</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">ls test</span>/
<span class="go">fuga hoge hoge.txt
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="13-2-startend-を使ったブレース展開" class="fragment"></span><a
      href="#13-2-startend-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%96%E3%83%AC%E3%83%BC%E3%82%B9%E5%B1%95%E9%96%8B"><i
        class="fa fa-link"></i></a>(13-2) <code>{start..end}</code> を使ったブレース展開
  </h2>
  <p><code>{}</code> の中で start と end の文字列の間にドットを2つ並べると、 start から end
    までの連続した文字や数字に展開されます。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">file0
</span><span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>file<span class="o">{</span>1..5<span class="o">}</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">file0 file1 file2 file3 file4 file5
</span><span class="gp">$</span><span class="w"> </span><span class="nb">touch </span>file<span class="o">{</span>d..g<span class="o">}</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">file0 file1 file2 file3 file4 file5 filed filee filef fileg
</span></code></pre>
    </div>
  </div>
  <p>この構文は for 文の単語リストにも使うことができます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..5<span class="o">}</span><span class="p">;</span> <span class="k">do
  </span>処理
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <h1>
    <span id="14-パス名展開とチルダ展開を使ってみよう" class="fragment"></span><a
      href="#14-%E3%83%91%E3%82%B9%E5%90%8D%E5%B1%95%E9%96%8B%E3%81%A8%E3%83%81%E3%83%AB%E3%83%80%E5%B1%95%E9%96%8B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>14. パス名展開とチルダ展開を使ってみよう
  </h1>
  <h2>
    <span id="14-1---を使ったパス名展開" class="fragment"></span><a
      href="#14-1---%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%91%E3%82%B9%E5%90%8D%E5%B1%95%E9%96%8B"><i
        class="fa fa-link"></i></a>(14-1) <code>*</code>, <code>?</code> を使ったパス名展開
  </h2>
  <p>パス名展開では、<code>*</code> や <code>?</code>
    などの記号をパス名やファイルの文字列に置き換えます。<br>
    <code>*</code> は任意の文字列にマッチして展開されます。
  </p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-a</span>                               <span class="c"># .txt も表示するために -a オプション</span>
<span class="go">. .. .txt 0.txt 123.txt hoge.txt fuga.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="k">*</span>.txt                            <span class="c"># パス名展開では隠しファイルの . にはマッチしない</span>
<span class="go">0.txt 123.txt hoge.txt fuga.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> .<span class="k">*</span>                               <span class="c"># . にマッチさせるには明示的に . を書く必要がある</span>
<span class="go">. .. .txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="k">*</span>.sh                             <span class="c"># パス名展開した結果１個もマッチしない場合はそのままの文字列で実行される</span>
<span class="go">ls: *.sh: No such file or directory
</span></code></pre>
    </div>
  </div>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p>パス名展開ではディレクトリをまたいだ展開はできません</p>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls test</span>/texts/<span class="k">*</span>.txt
<span class="go">0.txt 123.txt hoge.txt fuga.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls test</span>/<span class="k">*</span>.txt       
<span class="go">ls: test/*.txt: No such file or directory
</span></code></pre>
        </div>
      </div>
    </div>
  </div>
  <p><code>?</code> は任意の1文字に展開されます。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-a</span>                               
<span class="go">. .. .txt 0.txt 123.txt hoge.txt fuga.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> ?.txt                            
<span class="go">0.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> ????.txt                         <span class="c"># ? を連続で使用することも可能</span>
<span class="go">hoge.txt fuga.txt
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="14-2-------を使ったパス展開" class="fragment"></span><a
      href="#14-2-------%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%91%E3%82%B9%E5%B1%95%E9%96%8B"><i
        class="fa fa-link"></i></a>(14-2) <code>[ ]</code>, <code>[! ]</code>, <code>[^ ]</code>
    を使ったパス展開
  </h2>
  <p><code>[ ]</code> の中に1つ以上の文字を書くと、その中のいずれか1文字にマッチします。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">aaa.txt aab.txt aac.txt aad.txt aae.txt aaf.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls </span>aa[abcd].txt <span class="c"># ls aaa.txt aab.txt aac.txt aad.txt に展開される</span>
<span class="go">aaa.txt aab.txt aac.txt aad.txt
</span></code></pre>
    </div>
  </div>
  <p><code>[! ]</code>, <code>[^ ]</code> を用いると、 <code>[ ]</code>
    の中に含まれていない1文字にマッチします。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">aaa.txt aab.txt aac.txt aad.txt aae.txt aaf.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls </span>aa[!abcd].txt 
<span class="go">aae.txt aaf.txt
</span></code></pre>
    </div>
  </div>
  <p>パス名展開の記号は複数組み合わせて使うことも可能です。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-a</span>                               
<span class="go">. .. .txt 0.txt 123.txt hoge.txt fuga.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span> <span class="o">[</span>0-9]<span class="k">*</span>.txt
<span class="go">0.txt 123.txt
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="14-3--を使ったチルダ展開" class="fragment"></span><a
      href="#14-3--%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%81%E3%83%AB%E3%83%80%E5%B1%95%E9%96%8B"><i
        class="fa fa-link"></i></a>(14-3) <code>~</code> を使ったチルダ展開
  </h2>
  <p>チルダ展開では <code>~</code> がユーザーのホームディレクトリに展開されます。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="o">(</span><span class="nb">cd</span> ~/bin<span class="p">;</span> <span class="nb">pwd</span><span class="o">)</span> <span class="c"># (cd /home/user1/bin; pwd) に展開される。サブシェルなのでディレクトリは移動しない。</span>
<span class="go">/home/user1/bin
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="15-コマンド置換を使ってみよう" class="fragment"></span><a
      href="#15-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E7%BD%AE%E6%8F%9B%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>15. コマンド置換を使ってみよう
  </h1>
  <h2>
    <span id="15-1---を使ったコマンド置換" class="fragment"></span><a
      href="#15-1---%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E7%BD%AE%E6%8F%9B"><i
        class="fa fa-link"></i></a>(15-1) <code>$( )</code> を使ったコマンド置換
  </h2>
  <p>コマンド置換ではコマンド実行による出力をそのまま文字列に展開します。コマンド置換は <code>$(コマンド)</code>
    のように書きます。<code>$( )</code> の中に書いたコマンドが実行され、標準出力に出力された文字列が展開されます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">touch</span> <span class="si">$(</span><span class="nb">date</span> +%Y-%m-%d<span class="si">)</span>.txt
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">
</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">2023-12-01.txt
</span></code></pre>
    </div>
  </div>
  <p>コマンド置換は <code>`コマンド`</code>
    でも可能ですが、こちらは入れ子にするのが難しく、見た目上もわかりづらいため、基本的には <code>$(コマンド)</code> を使用するのをオススメします。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">var</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="si">$(</span><span class="nb">cat</span> <span class="o">&lt;&lt;&lt;</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)))</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="k">}</span><span class="s2">"</span>

<span class="nv">var2</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="se">\`</span><span class="nb">cat</span> <span class="o">&lt;&lt;&lt;</span> <span class="se">\\\`</span><span class="nb">pwd</span><span class="se">\\\`\`</span><span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var2</span><span class="k">}</span><span class="s2">"</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">/home/myname/work
/home/myname/work
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="16-シェルスクリプトで計算をしてみよう" class="fragment"></span><a
      href="#16-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A8%88%E7%AE%97%E3%82%92%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>16. シェルスクリプトで計算をしてみよう
  </h1>
  <h2>
    <span id="16-1-----を使った算術式の計算と評価" class="fragment"></span><a
      href="#16-1-----%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E7%AE%97%E8%A1%93%E5%BC%8F%E3%81%AE%E8%A8%88%E7%AE%97%E3%81%A8%E8%A9%95%E4%BE%A1"><i
        class="fa fa-link"></i></a>(16-1) <code>$(( ))</code>, <code>(( ))</code> を使った算術式の計算と評価
  </h2>
  <p>シェルスクリプトでの計算には <code>$(( 算術式 ))</code>, 数値比較等の評価には
    <code>(( 算術式 ))</code> を使いましょう。計算だけしたいのに <code>(( 算術式 ))</code> を使うと予期せぬエラーになり得ます。また、
    <code>let</code> や <code>expr</code> などの算術計算のためのコマンドもありますが、基本的に使用しません。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">x</span><span class="o">=</span><span class="k">$((</span><span class="m">100</span><span class="o">+</span><span class="m">200</span><span class="k">))</span>
<span class="nb">echo </span>終了ステータス: <span class="nv">$?</span>
<span class="nb">echo </span>x: <span class="nv">$x</span>

<span class="c"># (( )) は評価した結果が真（0 以外）であれば終了ステータスが成功(0)、偽（0）であれば失敗(1)となる</span>
<span class="o">((</span>x <span class="o">&gt;</span> 1000<span class="o">))</span>
<span class="nb">echo </span>終了ステータス: <span class="nv">$?</span> <span class="c"># 偽なので 1</span>
<span class="nb">echo </span>x: <span class="nv">$x</span>

<span class="o">((</span>x &lt; 1000<span class="o">))</span>
<span class="nb">echo </span>終了ステータス: <span class="nv">$?</span> <span class="c"># 真なので 0</span>
<span class="nb">echo </span>x: <span class="nv">$x</span>

<span class="nv">x</span><span class="o">=</span>0
<span class="o">((</span>x++<span class="o">))</span> <span class="c"># インクリメント前の値 0 として評価され、偽となるので、終了ステータスは 1</span>
<span class="nb">echo </span>終了ステータス: <span class="nv">$?</span>
<span class="nb">echo </span>x: <span class="nv">$x</span>

<span class="nv">x</span><span class="o">=</span>0
<span class="nv">x</span><span class="o">=</span><span class="k">$((</span>x <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
<span class="nb">echo </span>終了ステータス: <span class="nv">$?</span> <span class="c"># 計算は成功するので終了ステータスは 0</span>
<span class="nb">echo </span>x: <span class="nv">$x</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">終了ステータス: 0
x: 300
終了ステータス: 1
x: 300
終了ステータス: 0
x: 300
終了ステータス: 1
x: 1
終了ステータス: 0
x: 1
</span></code></pre>
    </div>
  </div>
  <h1>
    <span id="17-可読性を上げるためにコーディング規約を守ろう" class="fragment"></span><a
      href="#17-%E5%8F%AF%E8%AA%AD%E6%80%A7%E3%82%92%E4%B8%8A%E3%81%92%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AB%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E8%A6%8F%E7%B4%84%E3%82%92%E5%AE%88%E3%82%8D%E3%81%86"><i
        class="fa fa-link"></i></a>17. 可読性を上げるためにコーディング規約を守ろう
  </h1>
  <p>
    シェルスクリプトは自由度が高く、簡単に書き始めることができますが、自由度が高い分チーム内で品質を合わせづらいです。可読性の低い書き方になってしまうと、バグの原因になってしまうこともあるため、一定の規約を設けて読みやすいシェルスクリプトを書くための仕組みを作るのがいいでしょう。細かい規約はチームごとに変える必要はあると思いますが、大まかな指針を以下で解説します。
  </p>
  <p>以下の指針は基本的に Google のスタイルガイドを参考にしています。</p>
  <p
      src="https://qiita.com/embed-contents/link-card#qiita-embed-content__c6e263da4c8f76c8a79885f0d49f5fba"
      data-content="https%3A%2F%2Fgoogle.github.io%2Fstyleguide%2Fshellguide.html" frameborder="0" scrolling="no"
      loading="lazy" style="width:100%;" height="29">
    </iframe>
  </p>
  <h2>
    <span id="17-1-ファイルの冒頭にはこれを書こう" class="fragment"></span><a
      href="#17-1-%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%86%92%E9%A0%AD%E3%81%AB%E3%81%AF%E3%81%93%E3%82%8C%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a>(17-1) ファイルの冒頭にはこれを書こう
  </h2>
  <h3>
    <span id="shebang-を書こう" class="fragment"></span><a href="#shebang-%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a>shebang を書こう
  </h3>
  <p>特に <code>sh</code> を使うわけではないなら 1 行目に <code>#!/bin/bash</code>
    を明示しておきましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="オプションを書こう" class="fragment"></span><a
      href="#%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a>オプションを書こう
  </h3>
  <p>オプションは shebang で定義することも可能ですが、スクリプトファイルを直接指定する以外の方法で起動される場合もあるので
    2行目に <code>set</code> で定義しておきましょう。とりあえず <code>-euxCo pipefail</code>
    を指定しておけばいいと思います。オプションが不要になったら都度 <code>+</code> で無効化しましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euxCo</span> pipefail

<span class="nb">set</span> +x
<span class="nb">echo</span> <span class="s2">"ここはデバッグ不要"</span>
<span class="nb">set</span> <span class="nt">-x</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="処理内容が作業ディレクトリに依存しないようにディレクトリを移動しよう" class="fragment"></span><a
      href="#%E5%87%A6%E7%90%86%E5%86%85%E5%AE%B9%E3%81%8C%E4%BD%9C%E6%A5%AD%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%81%AB%E4%BE%9D%E5%AD%98%E3%81%97%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E7%A7%BB%E5%8B%95%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>処理内容が作業ディレクトリに依存しないようにディレクトリを移動しよう
  </h3>
  <p>
    シェルスクリプトはスクリプトを起動したディレクトリをカレントディレクトリとして動作します。そのため、シェルスクリプトファイルからの相対パスで別のファイルを参照している場合などは、作業ディレクトリからシェルスクリプトファイルを起動すると想定通りに動かないことがあります。
  </p>
  <details>
    <summary>NG例</summary>
    <div>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euxCo</span> pipefail
<span class="nb">cat </span>hello.txt
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">test.sh hello.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>hello.txt
<span class="go">hello
</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">+ cat hello.txt
hello
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cd</span> ..
<span class="gp">$</span><span class="w"> </span>./work/test.sh
<span class="go">+ cat hello.txt
cat: hello.txt: No such file or directory
</span></code></pre>
        </div>
      </div>
    </div>
  </details>
  <p>これを回避するために、次のようにシェルスクリプトの冒頭でスクリプトがあるディレクトリに移動しておくといいです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euxCo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">test.sh hello.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>hello.txt
<span class="go">hello
</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">+ cat hello.txt
hello
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cd</span> ..
<span class="gp">$</span><span class="w"> </span>./work/test.sh
<span class="go">++ dirname ./work/test.sh
+ cd ./work
+ cat hello.txt
hello
</span></code></pre>
    </div>
  </div>
  <p>
    ただし、この方法を用いる場合は、シェルスクリプト内の全てのパスをスクリプトの場所からの相対パスで書くか、絶対パスで書く必要があります。作業ディレクトリに依存したシェルスクリプトは書かないようにしましょう。
  </p>
  <h3>
    <span id="usage-関数で処理内容および使い方をスクリプト内に記載しよう" class="fragment"></span><a
      href="#usage-%E9%96%A2%E6%95%B0%E3%81%A7%E5%87%A6%E7%90%86%E5%86%85%E5%AE%B9%E3%81%8A%E3%82%88%E3%81%B3%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%92%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E5%86%85%E3%81%AB%E8%A8%98%E8%BC%89%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a><code>usage</code> 関数で処理内容および使い方をスクリプト内に記載しよう
  </h3>
  <p>何をするスクリプトなのか、どのような引数を指定すればいいのかなどを <code>usage</code>
    関数にまとめておきましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euxCo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>

<span class="k">function </span>usage<span class="o">()</span> <span class="o">{</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt;&amp;2 # ヒアドキュメントを使う際はリダイレクトをここに書きます
Description:
  Description of this script.
  
Usage:
  </span><span class="nv">$0</span><span class="sh"> [OPTIONS] &lt;FILE&gt;

Options:
  --version, -v   print "</span><span class="si">$(</span><span class="nb">basename</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="sh">" version
  --help, -h      print this
</span><span class="no">EOF 
</span><span class="nb">exit </span>1
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="getopts-コマンドでオプション解析を行おう" class="fragment"></span><a
      href="#getopts-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E8%A7%A3%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a><code>getopts</code> コマンドでオプション解析を行おう
  </h3>
  <p><code>getopts</code> という組み込みコマンドと <code>while</code>,
    <code>case</code> 文を組み合わせることで、オプションの解析が簡単になります。先ほどの <code>usage</code> 関数に合うようにオプション解析を実装しましょう。
  </p>
  <div>
    <span class="fa fa-fw fa-check-circle"></span>
    <div>
      <details>
        <summary><b><code>getopts</code> コマンドの使い方</b></summary>
        <div>
          <p><code>getopts</code>
            コマンドは第1引数で渡されたオプション候補とシェルスクリプト実行時に渡された引数を順に照らし合わせていき、マッチ結果を第2引数で渡された変数に格納します。第2引数で渡す変数名は何でも構いません。
          </p>
          <p>第1引数のオプション候補については以下のような特徴があります。</p>
          <ul>
            <li>オプション候補とできるのは引数で <code>-</code>
              の後に続く英字1文字に限ります(大文字小文字どちらも可能)。<code>--help</code> のようなロングオプションを候補とすることはできません。</li>
            <li>先頭の <code>:</code>
              はどの候補にもマッチしない引数が渡された時にエラーメッセージを表示しないようにするための記号です。これを使う場合は case 文の最後に <code>*)</code>
              でどの候補にもマッチしなかった場合の処理を独自に設定しておく必要があります。</li>
            <li>オプションの英字の後に <code>:</code>
              をつけると、そのオプションは引数を取ることを意味します。例えば <code>a:</code> とした場合は <code>-a</code>
              というオプションは引数を取り、シェルスクリプト実行時に <code>-a aaa</code> のように指定することになります。オプションの引数は
              <code>OPTARG</code> という特殊変数に格納されます。これは他の変数名で代替することはできません。
            </li>
          </ul>
        </div>
      </details>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euxCo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>

<span class="k">function </span>usage<span class="o">()</span> <span class="o">{</span>
<span class="o">(</span>省略<span class="o">)</span>
<span class="o">}</span>

<span class="k">while </span><span class="nb">getopts</span> :a:bc:hH OPT<span class="p">;</span> <span class="k">do
  case</span> <span class="nv">$OPT</span> <span class="k">in
    </span>a<span class="p">)</span>
      <span class="nb">echo</span> <span class="s2">"[-a] が指定されました(引数: </span><span class="k">${</span><span class="nv">OPTARG</span><span class="k">}</span><span class="s2">)"</span>
      <span class="p">;;</span>
    b<span class="p">)</span>
      <span class="nb">echo</span> <span class="s2">"[-b] が指定されました"</span>
      <span class="p">;;</span>
    c<span class="p">)</span>
      <span class="nb">echo</span> <span class="s2">"[-c] が指定されました(引数: </span><span class="k">${</span><span class="nv">OPTARG</span><span class="k">}</span><span class="s2">)"</span>
      <span class="p">;;</span>
    h <span class="p">|</span> H<span class="p">)</span>
      usage
      <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span>
      <span class="nb">echo</span> <span class="s2">"不正なオプションが指定されました: </span><span class="k">${</span><span class="nv">OPT</span><span class="k">}</span><span class="s2">"</span>
      <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <p>(5-3)</a>で紹介した <code>$#</code>,
    <code>shift</code>, 位置パラメータを組み合わせることでもオプション解析はできますが、 <code>getopts</code>
    コマンドを使う方が簡単に解析できると思います。ただし、ロングオプションを使う場合は <code>$#</code>, <code>shift</code>,
    位置パラメータを組み合わせたオプション解析を行うのがいいでしょう。
  </p>
  <div>
    <span class="fa fa-fw fa-exclamation-circle"></span>
    <div>
      <p><code>getopts</code>
        を使えばシェルスクリプトでオプション解析を実装するのが少しは簡単になるとは言え、豊富なオプションを受け付けるのは多くの場合労力がかかります。オプション解析を実装する代わりに、環境変数でオプション値を受け渡したが方がシンプルで可読性も高くなる場合があります。
      </p>
      <div class="code-frame" data-lang="bash">
        <div class="code-lang"><span class="bold">test.sh</span></div>
        <div class="highlight">
          <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euxCo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>

<span class="nv">option_a</span><span class="o">=</span><span class="k">${</span><span class="nv">OPTION_A</span><span class="k">}</span>
<span class="nv">option_b</span><span class="o">=</span><span class="k">${</span><span class="nv">OPTION_B</span><span class="k">}</span>
</code></pre>
        </div>
      </div>
      <div class="code-frame" data-lang="shell-session">
        <div class="code-lang"><span class="bold">terminal</span></div>
        <div class="highlight">
          <pre><code><span class="gp">$</span><span class="w"> </span><span class="nv">OPTION_A</span><span class="o">=</span><span class="s2">"hoge"</span> ./test.sh
</code></pre>
        </div>
      </div>
    </div>
  </div>
  <h2>
    <span id="17-2-スペース改行を使って見やすくしよう" class="fragment"></span><a
      href="#17-2-%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E6%94%B9%E8%A1%8C%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E8%A6%8B%E3%82%84%E3%81%99%E3%81%8F%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(17-2) スペース、改行を使って見やすくしよう
  </h2>
  <h3>
    <span id="インデントは半角スペース2つにしよう" class="fragment"></span><a
      href="#%E3%82%A4%E3%83%B3%E3%83%87%E3%83%B3%E3%83%88%E3%81%AF%E5%8D%8A%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B92%E3%81%A4%E3%81%AB%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>インデントは半角スペース2つにしよう
  </h3>
  <p>
    シェルスクリプトではコマンド同士をパイプで繋いだりする関係で1行が長くなりがちです。なるべく1行に収めるためにインデントは半角スペース2つにしておくといいでしょう。</p>
  <h3>
    <span id="パイプの前後には半角スペースを1つずつ入れよう" class="fragment"></span><a
      href="#%E3%83%91%E3%82%A4%E3%83%97%E3%81%AE%E5%89%8D%E5%BE%8C%E3%81%AB%E3%81%AF%E5%8D%8A%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%921%E3%81%A4%E3%81%9A%E3%81%A4%E5%85%A5%E3%82%8C%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>パイプの前後には半角スペースを1つずつ入れよう
  </h3>
  <p>パイプ (<code>|</code>) の前後には半角スペースがあった方が見やすいです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code>command1 | command2 <span class="c"># 見やすい</span>
command1| command2  <span class="c"># 見にくい</span>
command1 |command2  <span class="c"># 見にくい</span>
command1|commnad2   <span class="c"># 見にくい</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="リダイレクトの前には半角スペースを1つ入れ後ろにはスペースを入れないようにしよう" class="fragment"></span><a
      href="#%E3%83%AA%E3%83%80%E3%82%A4%E3%83%AC%E3%82%AF%E3%83%88%E3%81%AE%E5%89%8D%E3%81%AB%E3%81%AF%E5%8D%8A%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%921%E3%81%A4%E5%85%A5%E3%82%8C%E5%BE%8C%E3%82%8D%E3%81%AB%E3%81%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%92%E5%85%A5%E3%82%8C%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>リダイレクトの前には半角スペースを1つ入れ、後ろにはスペースを入れないようにしよう
  </h3>
  <p><code>&gt;</code>
    前の数字との間に半角スペースを入れるのはそもそも文法的な間違いです。<code>&gt;</code> には見やすいようにスペースを入れましょう。</p>
  <div class="code-frame" data-lang="shell-session">
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo </span>aaa 1&gt; sample.txt  <span class="c"># 見やすい</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>sample.txt
<span class="go">aaa
</span><span class="gp">$</span><span class="w"> </span><span class="nb">echo </span>aaa 1 <span class="o">&gt;</span> sample.txt <span class="c"># 文法的な間違い</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>sample.txt 
<span class="go">aaa 1
</span><span class="gp">$</span><span class="w"> </span><span class="nb">echo </span>aaa 1&gt;sample.txt   <span class="c"># 見づらい</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>sample.txt
<span class="go">aaa
</span></code></pre>
    </div>
  </div>
  <h3>
    <span id="1行で表示しきれない場合は--で改行しよう" class="fragment"></span><a
      href="#1%E8%A1%8C%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%97%E3%81%8D%E3%82%8C%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AF--%E3%81%A7%E6%94%B9%E8%A1%8C%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>1行で表示しきれない場合は <code>\</code> で改行しよう
  </h3>
  <p>1行が長くなってきた場合は、適宜 <code>\</code> で改行しましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nb">echo</span> <span class="s1">'この行は非常に非常に非常に非常に非常に非常に非常に非常に非常に非常に非常に'</span><span class="se">\</span>
<span class="s1">'長いです'</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">この行は非常に非常に非常に非常に非常に非常に非常に非常に非常に非常に非常に長いです
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="17-3-変数展開の書き方を守ろう" class="fragment"></span><a
      href="#17-3-%E5%A4%89%E6%95%B0%E5%B1%95%E9%96%8B%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%82%92%E5%AE%88%E3%82%8D%E3%81%86"><i
        class="fa fa-link"></i></a>(17-3) 変数、展開の書き方を守ろう
  </h2>
  <h3>
    <span id="複数単語の場合は-_-で結合しよう" class="fragment"></span><a
      href="#%E8%A4%87%E6%95%B0%E5%8D%98%E8%AA%9E%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AF-_-%E3%81%A7%E7%B5%90%E5%90%88%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>複数単語の場合は <code>_</code> で結合しよう
  </h3>
  <p>文法的な決まりではないですが、変数名はいわゆるスネークケースという形式で書きましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">sample_variable</span><span class="o">=</span><span class="s2">"sample variable"</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="変数宣言の右辺が文字列の場合は--で囲おう" class="fragment"></span><a
      href="#%E5%A4%89%E6%95%B0%E5%AE%A3%E8%A8%80%E3%81%AE%E5%8F%B3%E8%BE%BA%E3%81%8C%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AF--%E3%81%A7%E5%9B%B2%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>変数宣言の右辺が文字列の場合は <code>""</code> で囲おう
  </h3>
  <p</code> で囲んでおきましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">sample_variable</span><span class="o">=</span><span class="s2">"sample variable"</span> <span class="c"># OK</span>
<span class="nv">sample_variable</span><span class="o">=</span>sample variable   <span class="c"># NG</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="定数は大文字定数以外は小文字で書こう" class="fragment"></span><a
      href="#%E5%AE%9A%E6%95%B0%E3%81%AF%E5%A4%A7%E6%96%87%E5%AD%97%E5%AE%9A%E6%95%B0%E4%BB%A5%E5%A4%96%E3%81%AF%E5%B0%8F%E6%96%87%E5%AD%97%E3%81%A7%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a>定数は大文字、定数以外は小文字で書こう
  </h3>
  <p>定数は、定数だということがわかりやすいように大文字で書きましょう。スネークケースなのは通常の変数名と同じです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">CONST_VARIABLE</span><span class="o">=</span><span class="s2">"const variable"</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="定数は-readonly-で宣言しよう" class="fragment"></span><a
      href="#%E5%AE%9A%E6%95%B0%E3%81%AF-readonly-%E3%81%A7%E5%AE%A3%E8%A8%80%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>定数は <code>readonly</code> で宣言しよう
  </h3>
  <p>定数は予期せず値を変更されないように <code>readonly</code>
    付きで宣言して、読み込み専用にしておきましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nb">readonly </span><span class="nv">CONST_VARIABLE</span><span class="o">=</span><span class="s2">"const variable"</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="ファイル名ディレクトリ名を格納する変数は定数にしよう" class="fragment"></span><a
      href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E5%90%8D%E3%82%92%E6%A0%BC%E7%B4%8D%E3%81%99%E3%82%8B%E5%A4%89%E6%95%B0%E3%81%AF%E5%AE%9A%E6%95%B0%E3%81%AB%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>ファイル名、ディレクトリ名を格納する変数は定数にしよう
  </h3>
  <p>
    ファイル名、ディレクトリ名は一度定義してしまえばスクリプト内で変えることは滅多にないはずなので、定数にしておきましょう。定数にするということは（上記の規約的に言えば）変数名を大文字のスネークケースにして、<code>readonly</code>
    付きで宣言するということです。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nb">readonly </span><span class="nv">FILE_NAME</span><span class="o">=</span><span class="s2">"/home/myname/work/sample.txt"</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="パラメータ展開をする際は--で囲おう" class="fragment"></span><a
      href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%B1%95%E9%96%8B%E3%82%92%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AF--%E3%81%A7%E5%9B%B2%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>パラメータ展開をする際は <code>${}</code> で囲おう
  </h3>
  <p>定義済みの変数をパラメータ展開で参照する場合は <code>$変数名</code> ではなく、
    <code>${変数名}</code> を使うようにしましょう。<code>${変数名}</code>
    の方がパラメータ展開を使っていることがわかりやすく、また変数名と文字列が連結することによる不意なエラーを防ぐことができます。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">var</span><span class="o">=</span><span class="s2">"hoge"</span>
<span class="nb">echo</span> <span class="s2">"varの値は</span><span class="k">${</span><span class="nv">var</span><span class="k">}</span><span class="s2">です。"</span> 
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">var</span><span class="k">}</span><span class="s2">fuga"</span>
</code></pre>
    </div>
  </div>
  <p>ただし、<code>$0</code>, <code>$1</code>, <code>$@</code>,
    <code>$?</code> 等の特殊パラメータはそのままでもわかりやすいので {} をつけなくてもいいでしょう。
  </p>
  <h3>
    <span id="未定義または空文字になる可能性がある場合はデフォルト値で埋めるかエラーメッセージを表示する" class="fragment"></span><a
      href="#%E6%9C%AA%E5%AE%9A%E7%BE%A9%E3%81%BE%E3%81%9F%E3%81%AF%E7%A9%BA%E6%96%87%E5%AD%97%E3%81%AB%E3%81%AA%E3%82%8B%E5%8F%AF%E8%83%BD%E6%80%A7%E3%81%8C%E3%81%82%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AF%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E5%80%A4%E3%81%A7%E5%9F%8B%E3%82%81%E3%82%8B%E3%81%8B%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B"><i
        class="fa fa-link"></i></a>未定義または空文字になる可能性がある場合はデフォルト値で埋めるかエラーメッセージを表示する
  </h3>
  <p>
    オプションを環境変数で指定するようにしている場合や、コマンド置換を使って変数にコマンドの結果を格納しようとしている場合は、変数の値が空文字になる場合があります。そのような場合に備えてパラメータ展開時にデフォルト値を埋めるか、エラーメッセージを指定しましょう。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">cat_result</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> ./sample.txt<span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">cat_result</span><span class="k">:-</span><span class="nv">default</span><span class="p"> text</span><span class="k">}</span>

<span class="nv">open_api_key</span><span class="o">=</span><span class="k">${</span><span class="nv">OPEN_API_KEY</span>:?Specify<span class="p"> OPEN_API_KEY</span><span class="k">}</span> 
</code></pre>
    </div>
  </div>
  <h3>
    <span id="コマンド置換は--で囲おう" class="fragment"></span><a
      href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E7%BD%AE%E6%8F%9B%E3%81%AF--%E3%81%A7%E5%9B%B2%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>コマンド置換は <code>$()</code> で囲おう
  </h3>
  <p>コマンド置換は <code>$( )</code> か <code>` `</code> で可能ですが、
    <code>$( )</code> の方が可読性が高く、ネストもしやすいので <code>$( )</code> の方を使いましょう。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="nv">cat_result</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> ./sample.txt<span class="si">)</span><span class="s2">"</span>
<span class="nv">cat_result</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> ./sample.txt<span class="sb">`</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="パラメータ展開している箇所は--で囲おう" class="fragment"></span><a
      href="#%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E5%B1%95%E9%96%8B%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E7%AE%87%E6%89%80%E3%81%AF--%E3%81%A7%E5%9B%B2%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>パラメータ展開している箇所は <code>""</code> で囲おう
  </h3>
  <p</code> で囲んでおくと安全です。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">cat_result</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat </span>sample.txt<span class="si">)</span>
<span class="nb">echo</span> <span class="k">${</span><span class="nv">cat_result</span><span class="k">}</span>   <span class="c"># "" で囲まないと結果をそのまま扱えない場合がある</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">cat_result</span><span class="k">}</span><span class="s2">"</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span><span class="nb">cat </span>sample.txt
<span class="go">hoge
fuga
</span><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">hoge fuga
hoge
fuga
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="17-4-関数の書き方を守ろう" class="fragment"></span><a
      href="#17-4-%E9%96%A2%E6%95%B0%E3%81%AE%E6%9B%B8%E3%81%8D%E6%96%B9%E3%82%92%E5%AE%88%E3%82%8D%E3%81%86"><i
        class="fa fa-link"></i></a>(17-4) 関数の書き方を守ろう
  </h2>
  <h3>
    <span id="function-を書こう" class="fragment"></span><a href="#function-%E3%82%92%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a><code>function</code> を書こう
  </h3>
  <p>関数定義の際に <code>function</code> や <code>()</code>
    を省略する記法もありますが、可読性のためにはどちらもつけておくのが良いでしょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">function </span>some_func<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"do something"</span>
  <span class="k">return </span>0
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="ローカル変数の先頭には-_-を付けよう" class="fragment"></span><a
      href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E5%A4%89%E6%95%B0%E3%81%AE%E5%85%88%E9%A0%AD%E3%81%AB%E3%81%AF-_-%E3%82%92%E4%BB%98%E3%81%91%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>ローカル変数の先頭には <code>_</code> を付けよう
  </h3>
  <p>
    関数内でしか使わない変数は積極的にローカル変数とし、ローカル変数とする場合は参照時にローカル変数だとわかりやすいように変数名の先頭に <code>_</code> をつけましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">function </span>some_func<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">_print_str</span><span class="o">=</span><span class="s2">"do something"</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">_print_str</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">return </span>0
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="関数名は-_-で区切ろう" class="fragment"></span><a
      href="#%E9%96%A2%E6%95%B0%E5%90%8D%E3%81%AF-_-%E3%81%A7%E5%8C%BA%E5%88%87%E3%82%8D%E3%81%86"><i
        class="fa fa-link"></i></a>関数名は <code>_</code> で区切ろう
  </h3>
  <p>変数名と同じく小文字のスネークケースで書きましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">function </span>some_func<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"do something"</span>
  <span class="k">return </span>0
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="必ず-return-しよう" class="fragment"></span><a href="#%E5%BF%85%E3%81%9A-return-%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>必ず
    <code>return</code> しよう
  </h3>
  <p>終了ステータスは正常終了時は 0、異常終了時は 0 以外になるようにしましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">function </span>some_func<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"test"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"success"</span>
    <span class="k">return </span>0
  <span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"fail"</span> <span class="o">&gt;</span>&amp;2
    <span class="k">return </span>1
  <span class="k">fi</span>
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <h2>
    <span id="17-5-制御文をきれいに書こう" class="fragment"></span><a
      href="#17-5-%E5%88%B6%E5%BE%A1%E6%96%87%E3%82%92%E3%81%8D%E3%82%8C%E3%81%84%E3%81%AB%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a>(17-5) 制御文をきれいに書こう
  </h2>
  <h3>
    <span id="if-と-then-は同一行に書き-の後ろは半角スペースを1つつけよう" class="fragment"></span><a
      href="#if-%E3%81%A8-then-%E3%81%AF%E5%90%8C%E4%B8%80%E8%A1%8C%E3%81%AB%E6%9B%B8%E3%81%8D-%E3%81%AE%E5%BE%8C%E3%82%8D%E3%81%AF%E5%8D%8A%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%921%E3%81%A4%E3%81%A4%E3%81%91%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>if と then は同一行に書き、; の後ろは半角スペースを1つつけよう
  </h3>
  <p>if 文は以下のように書きましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">if </span>条件<span class="p">;</span> <span class="k">then
  </span>処理
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <p>; を使わずに then
    の前で改行する書き方もありますが上記のように書くのが多いように思います。どちらで書いても構わないのですが、少なくともチーム内では書き方を統一しましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">if </span>条件
<span class="k">then
  </span>処理
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="if-文を省略せずに書こう" class="fragment"></span><a
      href="#if-%E6%96%87%E3%82%92%E7%9C%81%E7%95%A5%E3%81%9B%E3%81%9A%E3%81%AB%E6%9B%B8%E3%81%93%E3%81%86"><i
        class="fa fa-link"></i></a>if 文を省略せずに書こう
  </h3>
  <p>次のように if 文を使わなくても条件分岐を書くことができますが、わかりづらいので if 文を書くようにしましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="o">[[</span> <span class="s2">"</span><span class="nv">$var</span><span class="s2">"</span> <span class="nt">-eq</span> 0 <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"true"</span> <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"false"</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="if-や-while-文の条件は---ではなく---を使おう" class="fragment"></span><a
      href="#if-%E3%82%84-while-%E6%96%87%E3%81%AE%E6%9D%A1%E4%BB%B6%E3%81%AF---%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F---%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>if や while 文の条件は <code>[ ]</code> ではなく <code>[[ ]]</code> を使おう
  </h3>
  <p><code>[[ ]]</code>
    では単語分割されないため安全に変数扱うことができ、パターンマッチなど機能も豊富なので、<code>[ ]</code> ではなく <code>[[ ]]</code> を使うようにしましょう。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">if</span> <span class="o">[[</span> <span class="nv">$var</span> <span class="o">===</span> <span class="s2">"test"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"This is sample."</span>
<span class="k">fi</span>
</code></pre>
    </div>
  </div>
  <h3>
    <span id="for-while-と-do-は同一行に書き-の後ろは半角スペースを1つつけよう" class="fragment"></span><a
      href="#for-while-%E3%81%A8-do-%E3%81%AF%E5%90%8C%E4%B8%80%E8%A1%8C%E3%81%AB%E6%9B%B8%E3%81%8D-%E3%81%AE%E5%BE%8C%E3%82%8D%E3%81%AF%E5%8D%8A%E8%A7%92%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%82%921%E3%81%A4%E3%81%A4%E3%81%91%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>for, while と do は同一行に書き、; の後ろは半角スペースを1つつけよう
  </h3>
  <p>if 文は以下のように書きましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">for </span>変数 <span class="k">in </span>単語リスト<span class="p">;</span> <span class="k">do
  </span>処理
<span class="k">done

while </span>条件<span class="p">;</span> <span class="k">do
  </span>処理
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <p>; を使わずに do の前で改行する書き方もありますが、
    if　と合わせてこちらを推奨しています。どちらで書いても構わないのですが、少なくともチーム内では書き方を統一しましょう。</p>
  <div class="code-frame" data-lang="bash">
    <div class="highlight">
      <pre><code><span class="k">for </span>変数 <span class="k">in </span>単語リスト
<span class="k">do
  </span>処理
<span class="k">done

while </span>条件
<span class="k">do 
  </span>処理
<span class="k">done</span>
</code></pre>
    </div>
  </div>
  <h2>
    <span id="17-6-リンターフォーマッターを使おう" class="fragment"></span><a
      href="#17-6-%E3%83%AA%E3%83%B3%E3%82%BF%E3%83%BC%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%82%BF%E3%83%BC%E3%82%92%E4%BD%BF%E3%81%8A%E3%81%86"><i
        class="fa fa-link"></i></a>(17-6) リンター、フォーマッターを使おう
  </h2>
  <p>VSCode にシェルスクリプト用のリンター、フォーマッターの拡張機能が存在するので使っておくと良いでしょう。</p>
  <p><code>ShellCheck</code> (リンター)</p>
  <p
      src="https://qiita.com/embed-contents/link-card#qiita-embed-content__125682330054382b92785828a6b3bb37"
      data-content="https%3A%2F%2Fmarketplace.visualstudio.com%2Fitems%3FitemName%3Dtimonwong.shellcheck"
      frameborder="0" scrolling="no" loading="lazy" style="width:100%;" height="29">
    </iframe>
  </p>
  <p><code>shell-format</code> (フォーマッター)</p>
  <p
      src="https://qiita.com/embed-contents/link-card#qiita-embed-content__b749db2ed12f4ec74d598a191c874bec"
      data-content="https%3A%2F%2Fmarketplace.visualstudio.com%2Fitems%3FitemName%3Dfoxundermoon.shell-format"
      frameborder="0" scrolling="no" loading="lazy" style="width:100%;" height="29">
    </iframe>
  </p>
  <h1>
    <span id="18-最後に便利なシェルスクリプトで便利なコマンドを紹介" class="fragment"></span><a
      href="#18-%E6%9C%80%E5%BE%8C%E3%81%AB%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E7%B4%B9%E4%BB%8B"><i
        class="fa fa-link"></i></a>18. 最後に便利なシェルスクリプトで便利なコマンドを紹介！
  </h1>
  <h2>
    <span id="18-1-source-コマンドで他のシェルスクリプトから関数や変数を読み込もう" class="fragment"></span><a
      href="#18-1-source-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E4%BB%96%E3%81%AE%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%8B%E3%82%89%E9%96%A2%E6%95%B0%E3%82%84%E5%A4%89%E6%95%B0%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%82%E3%81%86"><i
        class="fa fa-link"></i></a>(18-1) <code>source</code> コマンドで他のシェルスクリプトから関数や変数を読み込もう
  </h2>
  <p><a
      href="(1-4)-%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">(1-4)</a>で紹介したようにシェルスクリプトの実行方法には以下の3つがあります。
  </p>
  <ol>
    <li>実行権限をつけたファイル名を指定して実行する</li>
    <li>
      <code>bash</code> や <code>sh</code> コマンドの引数と指定して実行する
    </li>
    <li>
      <code>source</code> または <code>.</code> コマンドの引数として指定して実行する
    </li>
  </ol>
  <p>このうち 1. と 2.
    の方法はシェルスクリプトの実行を命令した現在のプロセス（カレントシェル）から新しく子プロセスが作られ、その子プロセス上でシェルスクリプトが実行されます。シェルスクリプトが終了すると、子プロセス自体も終了し、呼び出し側のカレントシェルに子プロセスの状態は引き継がれません。
  </p>
  <p>逆に、3. の <code>source</code> または <code>.</code>
    コマンドを使用する方法では、シェルスクリプトがカレントシェルで実行されます。そのため、シェルスクリプト実行後の状態(変数や関数の定義など)がカレントシェルでも引き継がれます。</p>
  <p>ターミナルから <code>source</code> または <code>.</code>
    コマンドでシェルスクリプトを実行することはほぼありませんが、シェルスクリプト内で別のシェルスクリプトに書かれた設定や関数を使いたい場合は、<code>source</code> または
    <code>.</code> コマンドでシェルスクリプトを実行します。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">another.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="k">function </span>another_func<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"another func"</span>
<span class="o">}</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euCo</span> pipefail
<span class="nb">cd</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">dirname</span> <span class="s2">"</span><span class="nv">$0</span><span class="s2">"</span><span class="si">)</span><span class="s2">"</span>

<span class="nb">source</span> ./another.sh

another_func
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">another func
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="18-2-trap-コマンドでシェルスクリプトが終了中断した時の動作を実装しよう" class="fragment"></span><a
      href="#18-2-trap-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E3%82%B7%E3%82%A7%E3%83%AB%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%8C%E7%B5%82%E4%BA%86%E4%B8%AD%E6%96%AD%E3%81%97%E3%81%9F%E6%99%82%E3%81%AE%E5%8B%95%E4%BD%9C%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%97%E3%82%88%E3%81%86"><i
        class="fa fa-link"></i></a>(18-2) <code>trap</code> コマンドでシェルスクリプトが終了・中断した時の動作を実装しよう
  </h2>
  <p><code>trap</code>
    コマンドを使うことでシェルスクリプトが終了したり、中断した場合に必ず動く処理を定義しておくことができます。これを使うことで、中断時に作成途中のファイルを削除したり、終了時に終了時に退避していたファイルを元に戻したりすることができます。
  </p>
  <p><code>trap</code>
    コマンドは第1引数に実行する処理を文字列で渡します。また、第2引数以降でどのシグナルに対して処理を実行するのかを選択します。シグナルにはシグナル名とシグナル番号が割り振られており、どちらで指定しても構いません。例えば、
    <code>Ctrl-C</code> を押してプログラムを中断する際には <code>(SIG)INT</code> というシグナルが送られます。この <code>(SIG)INT</code>
    に対するシグナル番号は <code>2</code> となっています。また、シグナル番号 <code>0</code> はシェルスクリプト終了時に、プロセスが自分自身に対して創出する EXIT
    シグナルを表します。
  </p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">data</span><span class="o">=</span>
<span class="nv">SAVE_TMP_FILE</span><span class="o">=</span><span class="s2">"~/tmpdata.txt"</span>

<span class="k">function </span>save_tmp_data<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$data</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$SAVE_TMP_FILE</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"save data to </span><span class="nv">$SAVE_TMP_FILE</span><span class="s2">"</span>
<span class="o">}</span>

<span class="nb">trap</span> <span class="s2">"
  echo 'receive INT!'
  save_tmp_data         # 関数も実行できる
  exit 1                # exit しておかないと INT を受け取っても処理を続行してしまうので注意
"</span> INT                   <span class="c"># INT は 2 でも可</span>

<span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..100<span class="o">}</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$i</span><span class="s2">"</span>
  <span class="nv">data</span><span class="o">=</span><span class="k">$((</span>data <span class="o">+</span> i<span class="k">))</span>
<span class="k">done

</span><span class="nb">echo</span> <span class="nv">$data</span>
</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">1
2
3
^Creceive INT!
save data to ~/tmpdata.txt
</span><span class="gp">$</span><span class="w"> </span><span class="nb">cat</span> ~/tmpdata.txt
<span class="go">6
</span></code></pre>
    </div>
  </div>
  <h2>
    <span id="18-3-mktemp-コマンドで一時的に必要なファイルディレクトリを作ろう" class="fragment"></span><a
      href="#18-3-mktemp-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A7%E4%B8%80%E6%99%82%E7%9A%84%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%82%92%E4%BD%9C%E3%82%8D%E3%81%86"><i
        class="fa fa-link"></i></a>(18-3) <code>mktemp</code> コマンドで一時的に必要なファイル/ディレクトリを作ろう
  </h2>
  <p><code>mktemp</code> コマンドを使うと適当な名前のファイルが作成されます。 <code>-d</code>
    オプションをつけるとファイルではなくディレクトリが作成されます。これと上で紹介した <code>trap</code>
    コマンドを組み合わせることで、シェルスクリプトの処理中だけ存在するファイル、ディレクトリが使えます。</p>
  <div class="code-frame" data-lang="bash">
    <div class="code-lang"><span class="bold">test.sh</span></div>
    <div class="highlight">
      <pre><code><span class="c">#!/bin/bash</span>

<span class="nv">temp_file</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">temp_dir</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="si">)</span><span class="s2">"</span>

<span class="nb">trap</span> <span class="s2">"
  echo delete </span><span class="nv">$temp_file</span><span class="s2">
  rm -f </span><span class="nv">$temp_file</span><span class="s2">
  
  echo delete </span><span class="nv">$temp_dir</span><span class="s2">
  rm -rf </span><span class="nv">$temp_dir</span><span class="s2">
"</span> 0 <span class="c"># 実行終了時に必ず実行される(INTを受け取った場合でも)</span>

<span class="nb">echo</span> <span class="s2">"aaaa"</span> <span class="o">&gt;</span> <span class="nv">$temp_file</span>

<span class="nv">data</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$temp_file</span><span class="si">)</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="nv">$data</span>

</code></pre>
    </div>
  </div>
  <div class="code-frame" data-lang="shell-session">
    <div class="code-lang"><span class="bold">terminal</span></div>
    <div class="highlight">
      <pre><code><span class="gp">$</span><span class="w"> </span>./test.sh
<span class="go">aaaa
delete /var/folders/c0/b120wc4j3fn8nc055bjzcyt40000gn/T/tmp.QhkRN9Bg
delete /var/folders/c0/b120wc4j3fn8nc055bjzcyt40000gn/T/tmp.AjB0It3r
</span></code></pre>
    </div>
  </div>
</body>

</html>